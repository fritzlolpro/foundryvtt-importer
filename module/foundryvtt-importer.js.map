{"version":3,"file":"foundryvtt-importer.js","sources":["../src/module/constants.ts","../src/module/settings.ts","../src/module/preloadTemplates.ts","../src/module/formatters.ts","../src/module/table/lineManipulators.ts","../src/module/table/stringInspectors.ts","../src/module/table/parse.ts","../src/module/table/reddit.ts","../src/module/table/process.ts","../src/module/importGenericForm.ts","../src/module/importActorForm.ts","../src/module/importTableForm.ts","../src/module/importItemForm.ts","../src/module/importJournalForm.ts","../src/module/renderSidebarButtons.ts","../src/module/actor/parsers/generic.ts","../src/module/item/parsers/textBlock.ts","../src/module/item/process.ts","../src/module/item/handleInput.ts","../src/module/item/parsers/available.ts","../src/module/actor/templates/fifthedition.ts","../src/module/actor/convert.ts","../src/module/actor/interfaces.ts","../src/module/actor/parsers/wtcTextBlock.ts","../src/module/actor/parsers/available.ts","../src/module/actor/parsers/typeGuardParserRunners.ts","../src/module/actor/parsers/index.ts","../src/module/item/compendium/item.ts","../src/module/item/convert.ts","../src/module/actor/handleInput.ts","../src/module/guards/game.ts","../src/module/game/index.ts","../src/module/journal/builder/textBlock.ts","../src/module/journal/parsers/pdfJson.ts","../src/module/journal/parsers/textBlock.ts","../src/module/journal/parsers/multipleTextBlocks.ts","../src/module/journal/routes/journalFromJson.ts","../src/module/foundryvtt-importer.ts"],"sourcesContent":["const CONSTANTS = Object.freeze({\r\n  module: {\r\n    name: 'foundryvtt-importer',\r\n    title: 'Content Parser',\r\n  },\r\n});\r\n\r\nexport default CONSTANTS;\r\n","import CONSTANTS from './constants';\r\n\r\nexport interface ClientSettingsReader {\r\n  get<T>(scope: string, key: string): T;\r\n}\r\n\r\nexport class Config {\r\n  folderDepth = 3;\r\n  journalImporter = true;\r\n  tableImporter = true;\r\n  actorImporter = true;\r\n  itemImporter = true;\r\n\r\n  static keys = {\r\n    folderDepth: 'folderDepth',\r\n    journalImporter: 'journalImporter',\r\n    tableImporter: 'tableImporter',\r\n    actorImporter: 'actorImporter',\r\n    itemImporter: 'itemImporter',\r\n  };\r\n\r\n  public load(s: ClientSettingsReader): Config {\r\n    this.folderDepth = this.getSetting(s, Config.keys.folderDepth);\r\n    this.journalImporter = this.getSetting(s, Config.keys.journalImporter);\r\n    this.tableImporter = this.getSetting(s, Config.keys.tableImporter);\r\n    this.actorImporter = this.getSetting(s, Config.keys.actorImporter);\r\n    this.itemImporter = this.getSetting(s, Config.keys.itemImporter);\r\n\r\n    return this;\r\n  }\r\n\r\n  /**\r\n   * Helper method to quickly construct Settings from game.settings\r\n   */\r\n  static _load(): Config {\r\n    return new Config().load((game as Game).settings as ClientSettingsReader);\r\n  }\r\n\r\n  private getSetting<T>(settings: ClientSettingsReader, key: string) {\r\n    return settings.get<T>(CONSTANTS.module.name, key);\r\n  }\r\n}\r\n\r\nexport function registerSettings(): void {\r\n  if (game === {}) return;\r\n  else {\r\n    (game as Game)?.settings?.register(CONSTANTS.module.name, 'folderDepth', {\r\n      name: 'Folder Depth',\r\n      hint: `Folders will only be created up to this depth. If this is set above ${CONST.FOLDER_MAX_DEPTH}, make sure you have a module like MoarFolders to increase the default depth.`,\r\n      scope: 'world',\r\n      config: true,\r\n      type: Number,\r\n      default: CONST.FOLDER_MAX_DEPTH,\r\n    });\r\n    (game as Game)?.settings?.register(CONSTANTS.module.name, 'journalImporter', {\r\n      name: 'Journal Importer',\r\n      hint: 'Display the journal importer button. This imports JSON files and so it is less user friendly. (requires reload)',\r\n      scope: 'world',\r\n      config: true,\r\n      type: Boolean,\r\n      default: false,\r\n    });\r\n    (game as Game)?.settings?.register(CONSTANTS.module.name, 'tableImporter', {\r\n      name: 'Table Importer',\r\n      hint: 'Display the table importer button. This imports tables pasted from reddit.com/r/BehindTheTables and other formats. (requires reload)',\r\n      scope: 'world',\r\n      config: true,\r\n      type: Boolean,\r\n      default: true,\r\n    });\r\n    (game as Game)?.settings?.register(CONSTANTS.module.name, 'actorImporter', {\r\n      name: 'Actor Importer (5E only)',\r\n      hint: 'Display the actor importer button. This imports clipboard text formatted like a monster stat block (copied from a PDF) (requires reload)',\r\n      scope: 'world',\r\n      config: true,\r\n      type: Boolean,\r\n      default: true,\r\n    });\r\n    (game as Game)?.settings?.register(CONSTANTS.module.name, 'itemImporter', {\r\n      name: 'Item Importer (5E only)',\r\n      hint: 'Display the item importer button. This imports clipboard text formatted like an Item or Spell (copied from a PDF) (requires reload)',\r\n      scope: 'world',\r\n      config: true,\r\n      type: Boolean,\r\n      default: true,\r\n    });\r\n  }\r\n}\r\n","import CONSTANTS from './constants';\r\n\r\nexport async function preloadTemplates(): Promise<Handlebars.TemplateDelegate[]> {\r\n  const templatePaths: string[] = [\r\n    // Add paths to \"modules/foundryvtt-importer/templates\"\r\n    `modules/${CONSTANTS.module.name}/templates/importTableForm.hbs`,\r\n    `modules/${CONSTANTS.module.name}/templates/importActorForm.hbs`,\r\n    `modules/${CONSTANTS.module.name}/templates/importItemForm.hbs`,\r\n    `modules/${CONSTANTS.module.name}/templates/importJournalForm.hbs`,\r\n  ];\r\n\r\n  return loadTemplates(templatePaths);\r\n}\r\n","export function cleanName(name: string): string {\r\n  // replace all underscores with spaces\r\n  // and capitalize the first letter of each word\r\n  return name\r\n    .replace(/_/g, ' ')\r\n    .split(' ')\r\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1).toLowerCase())\r\n    .join(' ')\r\n    .replace(/%20/g, ' ')\r\n    .trim();\r\n}\r\n","import { TableEntry } from './parse';\r\n\r\nexport const WEIGHT_RANGE_REGEX = /^[0-9]{1,3}-[0-9]{1,3}./;\r\nexport const WEIGHT_REGEX = /^[0-9]{1,3}./;\r\n\r\nexport function hasWeightsRange(item: string) {\r\n  return WEIGHT_RANGE_REGEX.test(item.trim());\r\n}\r\nexport const breakLines = (data: string) => {\r\n  const rawLines = data.split('\\n');\r\n  return rawLines.filter((line) => {\r\n    return line !== '';\r\n  });\r\n};\r\n\r\nexport const rangeStringMap = (current: string): [number, number] => {\r\n  let start, end: number;\r\n  if (current.includes('-')) {\r\n    [start, end] = current.split('-').map(Number);\r\n  } else if (current.includes('–')) {\r\n    [start, end] = current.split('–').map(Number);\r\n  } else {\r\n    start = Number(current);\r\n    end = start;\r\n  }\r\n  if (end === 0) {\r\n    end = 100;\r\n  }\r\n  if (start === 0) {\r\n    start = 1;\r\n  }\r\n  return [start, end];\r\n};\r\nexport function addWeight(line: string): TableEntry {\r\n  let regex = WEIGHT_REGEX;\r\n  if (hasWeightsRange(line)) {\r\n    regex = WEIGHT_RANGE_REGEX;\r\n  }\r\n  const matches = line.trim().match(regex);\r\n  if (!matches || matches.length > 1) throw new Error(`Invalid line: ${line} ${matches}`);\r\n  return {\r\n    text: line.replace(regex, '').trim(),\r\n    range: rangeStringMap(matches[0]),\r\n  };\r\n}\r\n\r\nexport function hasWeights(item: string): boolean {\r\n  return WEIGHT_REGEX.test(item.trim());\r\n}\r\n","export const DIE_REGEX = /d[0-9]{1,4}/;\r\n\r\nexport function hasDieNumber(line: string) {\r\n  // match d4, d6, d8, d10, d12, d20, d100\r\n  return DIE_REGEX.test(line.trim());\r\n}\r\n","import { cleanName } from '../formatters';\r\nimport { TableParser } from './process';\r\nimport { addWeight, breakLines, hasWeights, rangeStringMap } from './lineManipulators';\r\nimport { hasDieNumber } from './stringInspectors';\r\n\r\nexport type TableData = ConstructorParameters<typeof foundry.documents.BaseRollTable>[0];\r\n\r\nexport interface TableEntry {\r\n  range: [number, number];\r\n  text: string;\r\n}\r\n\r\nexport interface FoundryTable {\r\n  name: string;\r\n  formula: string;\r\n  results: TableEntry[];\r\n}\r\n\r\nexport interface BasicTable {\r\n  name: string;\r\n  entries: string[];\r\n}\r\n\r\nexport function isFoundryTable(table: FoundryTable | BasicTable) {\r\n  return (table as FoundryTable).formula !== undefined;\r\n}\r\n\r\nexport function isBasicTable(table: FoundryTable | BasicTable) {\r\n  return (table as FoundryTable).formula === undefined;\r\n}\r\n\r\nconst entryStringMap = (current: string, index: number): TableEntry => {\r\n  return {\r\n    text: current,\r\n    range: [index + 1, index + 1],\r\n  };\r\n};\r\n\r\nexport function parseBasicJSON({ name, entries }: BasicTable) {\r\n  const results = entries.map(entryStringMap);\r\n  return {\r\n    name: name,\r\n    formula: formulaFromEntries(results),\r\n    results,\r\n  };\r\n}\r\n\r\nexport function parseFoundryJSON({ name, formula, results }: FoundryTable) {\r\n  return {\r\n    name: name,\r\n    formula,\r\n    results: [...results],\r\n  };\r\n}\r\n\r\nexport function formulaFromEntries(entries: TableEntry[]): string {\r\n  return `1d${entries[entries.length - 1].range[1]}`;\r\n}\r\n\r\nfunction nameFromFile(file: string) {\r\n  // get the filename without the extension\r\n  const withPath = file.split('.')[0];\r\n  // remove the file path\r\n  const name = withPath.split('/').pop() || withPath;\r\n  // replace all underscores with spaces\r\n  // and capitalize the first letter of each word\r\n  return cleanName(name);\r\n}\r\n\r\nexport function isCSVTable(data: string) {\r\n  const delims = ['|', ','];\r\n  const check = data.split('\\n')[0];\r\n  return delims.reduce((acc, cur) => check.includes(cur) || acc, false);\r\n}\r\n\r\nexport function isJSONTable(data: string) {\r\n  try {\r\n    JSON.parse(data);\r\n  } catch (e) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport function numWithWeights(entries: string[]) {\r\n  return entries.reduce((numWeights, cur) => {\r\n    if (hasWeights(cur)) {\r\n      numWeights += 1;\r\n    }\r\n    return numWeights;\r\n  }, 0);\r\n}\r\n\r\nconst trimDieLine = (line: string): string => {\r\n  return `1d${line.trim().split(' ')[0].replace('1d', '').replace('d', '')}`;\r\n};\r\n\r\nexport const parseFromTxt: TableParser = (input: string) => {\r\n  const table = input.replace('/t', '\\n');\r\n  const lines = breakLines(table);\r\n  let name = lines.shift() || 'Parsed Table';\r\n  const numWeighted: number = numWithWeights(lines);\r\n  let formula;\r\n  if (hasDieNumber(name)) {\r\n    const split = name.split(/(d[0-9]{1,4})/);\r\n    const dieLine = split[1];\r\n    name = split[0];\r\n    formula = trimDieLine(dieLine);\r\n  } else if (hasDieNumber(lines[0])) {\r\n    const dieLine = lines.shift();\r\n    if (!dieLine) {\r\n      throw new Error('No die line found');\r\n    }\r\n    formula = trimDieLine(dieLine);\r\n  }\r\n  let results;\r\n  if (numWeighted > 0) {\r\n    // remove any lines until we find the first line with weights\r\n    let firstWeightIndex = 0;\r\n\r\n    for (let i = 0; i < lines.length; i++) {\r\n      if (hasWeights(lines[i])) {\r\n        firstWeightIndex = i;\r\n        break;\r\n      }\r\n    }\r\n\r\n    results = lines.slice(firstWeightIndex).reduce(entryTxtReduce, []);\r\n  } else {\r\n    results = lines.map(entryStringMap);\r\n  }\r\n  results = results.map((entry) => {\r\n    entry.text = entry.text.trim();\r\n    return entry;\r\n  });\r\n  return {\r\n    name: nameFromFile(name),\r\n    formula: formula ?? formulaFromEntries(results),\r\n    results,\r\n  };\r\n};\r\n\r\nconst entryTxtReduce = (acc: TableEntry[], curr: string): TableEntry[] => {\r\n  if (hasWeights(curr)) {\r\n    const [stringRange, ...text] = curr.split(' ');\r\n    const [start, end] = rangeStringMap(stringRange);\r\n    acc.push({\r\n      text: text.join(' '),\r\n      range: [start, end],\r\n    });\r\n  } else {\r\n    acc[acc.length - 1].text += ` ${curr}`;\r\n  }\r\n  return acc;\r\n};\r\n\r\nconst entryCSVMap = (current: string): TableEntry => {\r\n  const [stringRange, text] = current.split('|');\r\n  const [start, end] = rangeStringMap(stringRange);\r\n  return {\r\n    text,\r\n    range: [start, end],\r\n  };\r\n};\r\n\r\nexport function parseFromCSV(table: BasicTable) {\r\n  const { name, entries } = table;\r\n  const results = entries.map(entryCSVMap);\r\n  return {\r\n    name: nameFromFile(name),\r\n    formula: formulaFromEntries(results),\r\n    results,\r\n  };\r\n}\r\n\r\nexport function parseMultiLineWeighted(inputTable: string) {\r\n  const lines = breakLines(inputTable);\r\n  let name = 'Parsed Table';\r\n  if (!hasWeights(lines[0])) {\r\n    name = lines.shift() || 'Parsed Table';\r\n  }\r\n  const withWeights = numWithWeights(lines);\r\n  if (withWeights !== lines.length / 2) {\r\n    throw new Error('Not a multi line weighted table');\r\n  }\r\n\r\n  const entries = lines.reduce((acc: TableEntry[], curr: string) => {\r\n    if (hasWeights(curr)) {\r\n      acc.push(addWeight(curr));\r\n    } else {\r\n      acc[acc.length - 1].text = curr;\r\n    }\r\n    return acc;\r\n  }, []);\r\n  const formula = formulaFromEntries(entries);\r\n  return {\r\n    name,\r\n    formula,\r\n    results: entries,\r\n  };\r\n}\r\n","import { formulaFromEntries, FoundryTable, TableEntry } from './parse';\r\nimport { addWeight, breakLines, hasWeights } from './lineManipulators';\r\nimport { hasDieNumber } from './stringInspectors';\r\n\r\nexport function cleanName(name: string) {\r\n  return name\r\n    .replace(/d[0-9]{1,3}/, '')\r\n    .replace(/[0-9]{1,3}/, '')\r\n    .trim();\r\n}\r\n\r\nexport function parseWeightedTable(userInput: string): FoundryTable {\r\n  const raw = breakLines(userInput);\r\n  const lines = raw.filter((line: string) => line !== '');\r\n  let rawName = 'Parsed Table';\r\n  if (!hasWeights(lines[0]) || hasDieNumber(lines[0])) {\r\n    rawName = lines.shift() || 'No Name';\r\n  }\r\n  const name = cleanName(rawName);\r\n  return applyWeights(name, lines);\r\n}\r\n\r\nexport interface TableCollection {\r\n  collection: FoundryTable[];\r\n  name: string;\r\n}\r\n\r\nexport function isRedditTable(userInput: string): boolean {\r\n  const parsed = parseWeightedTable(userInput);\r\n  parsed.results.forEach((entry: TableEntry) => {\r\n    if (entry.range[0] === NaN || entry.range[1] === NaN) {\r\n      return false;\r\n    }\r\n  });\r\n  return parsed.results.length > 0 && /^d[0-9]{1,3}/.test(userInput.trim());\r\n}\r\n\r\nexport function isRedditCollection(userInput: string) {\r\n  const parsed = parseRedditCollection(userInput);\r\n  parsed.collection.forEach((table) => {\r\n    table.results.forEach((entry) => {\r\n      if (entry.range[0] === NaN || entry.range[1] === NaN) {\r\n        return false;\r\n      }\r\n    });\r\n  });\r\n  return parsed.collection.length > 1 && userInput.split(/\\nd[0-9]{1,2}/).length > 1;\r\n}\r\n\r\nexport function applyWeights(name: string, lines: string[]): FoundryTable {\r\n  let results: TableEntry[] | undefined = undefined;\r\n  let formula = `1d${lines.length}`;\r\n  if (hasWeights(lines[0])) {\r\n    results = lines.map(addWeight);\r\n    formula = formulaFromEntries(results);\r\n  } else {\r\n    results = lines.map((line: string, index: number) => {\r\n      return {\r\n        range: [index + 1, index + 1],\r\n        text: line.trim(),\r\n      };\r\n    });\r\n  }\r\n  return {\r\n    name,\r\n    formula,\r\n    results,\r\n  };\r\n}\r\n\r\nexport function parseRedditTable(userInput: string): FoundryTable {\r\n  const raw = userInput.split('\\n');\r\n  const lines = raw.filter((line) => line !== '');\r\n  const rawName = lines.shift() || 'No Name';\r\n  const replacedName = rawName.replace(/d[0-9]{1,3}/, '').replace(/[0-9]{1,3}/, '');\r\n  const name = replacedName.trim();\r\n  return applyWeights(name, lines);\r\n}\r\n\r\nexport function parseRedditCollection(userInput: string): TableCollection {\r\n  const tables = userInput.split(/\\nd[0-9]{1,2}/);\r\n  return {\r\n    name: (tables.shift() || 'No Name').trim(),\r\n    collection: tables.map((table) => parseRedditTable(table)),\r\n  };\r\n}\r\n","import { UserData } from '../importForm';\r\nimport { isRedditCollection, isRedditTable, parseRedditCollection, parseWeightedTable } from './reddit';\r\nimport {\r\n  BasicTable,\r\n  FoundryTable,\r\n  isCSVTable,\r\n  isFoundryTable,\r\n  isJSONTable,\r\n  parseBasicJSON,\r\n  parseFoundryJSON,\r\n  parseFromCSV,\r\n  parseFromTxt,\r\n  parseMultiLineWeighted,\r\n  TableData,\r\n} from './parse';\r\nimport { breakLines } from './lineManipulators';\r\nasync function createTableFromJSON(tableJSON: FoundryTable | BasicTable) {\r\n  let parsed: TableData | undefined;\r\n  if (isFoundryTable(tableJSON)) {\r\n    parsed = parseFoundryJSON(tableJSON as FoundryTable);\r\n  } else {\r\n    parsed = parseBasicJSON(tableJSON as BasicTable);\r\n  }\r\n  await RollTable.create(parsed);\r\n}\r\n\r\nasync function jsonRoute(stringData: string) {\r\n  const json = JSON.parse(stringData) as FoundryTable;\r\n  createTableFromJSON(json);\r\n}\r\n\r\nexport type TableParser = (table: string) => FoundryTable;\r\n\r\nfunction tryParseTables(parsers: TableParser[], inputTable: string): FoundryTable {\r\n  for (const parser of parsers) {\r\n    try {\r\n      const table = parser(inputTable);\r\n      if (table) {\r\n        return table;\r\n      }\r\n    } catch (e) {\r\n      // trying other parsers\r\n    }\r\n  }\r\n  throw new Error(`Unable to parse table`);\r\n}\r\n\r\nexport function txtToFoundry(stringData: string) {\r\n  return tryParseTables([parseFromTxt, parseWeightedTable, parseMultiLineWeighted], stringData);\r\n}\r\n\r\nasync function txtRoute(stringData: string) {\r\n  console.log(`Data: ${stringData}`);\r\n  await RollTable.create(txtToFoundry(stringData));\r\n}\r\n\r\nasync function csvRoute(fullFileName: string, data: string) {\r\n  console.log(`CSV Data: ${data}`);\r\n  const lines = breakLines(data);\r\n  const parse = parseFromCSV({ name: fullFileName, entries: lines });\r\n  await RollTable.create(parse);\r\n}\r\n\r\nasync function handleRedditCollection(input: string) {\r\n  const parsed = parseRedditCollection(input);\r\n  const folder = await Folder.create({ name: parsed.name, type: 'RollTable', sorting: 'm' });\r\n  const promises = parsed.collection.map(async (table, index) => {\r\n    return RollTable.create({ ...table, folder: folder?.data?._id, sort: index });\r\n  });\r\n  await Promise.all(promises);\r\n}\r\n\r\nasync function redditTableRoute(input: string) {\r\n  if (isRedditCollection(input)) {\r\n    return handleRedditCollection(input);\r\n  } else {\r\n    const parsed = parseWeightedTable(input);\r\n    await RollTable.create(parsed);\r\n  }\r\n}\r\n\r\nexport async function processTableJSON({ jsonfile, clipboardInput }: UserData) {\r\n  if (clipboardInput) {\r\n    try {\r\n      if (isJSONTable(clipboardInput)) {\r\n        console.log(`Parsing as JSON`);\r\n        await jsonRoute(clipboardInput);\r\n      } else if (isCSVTable(clipboardInput)) {\r\n        console.log(`Parsing as CSV`);\r\n        await csvRoute('CSV Imported Table', clipboardInput);\r\n      } else if (isRedditCollection(clipboardInput)) {\r\n        console.log(`Parsing as Reddit Collection`);\r\n        await redditTableRoute(clipboardInput);\r\n      } else if (isRedditTable(clipboardInput)) {\r\n        console.log(`Parsing as Reddit Table`);\r\n        await redditTableRoute(clipboardInput);\r\n      } else {\r\n        console.log(`Parsing as TXT`);\r\n        await txtRoute(clipboardInput);\r\n      }\r\n    } catch (e) {\r\n      console.log(`Error while processing table: ${e} | attempting base text route parsing.`);\r\n      await txtRoute(clipboardInput);\r\n    }\r\n    return;\r\n  }\r\n  const response = await fetch(jsonfile);\r\n  if (!response.ok) {\r\n    console.log(`Error reading ${jsonfile}`);\r\n    return;\r\n  }\r\n  const data = await response.text();\r\n\r\n  const ext = jsonfile.split('.').pop();\r\n  switch (ext) {\r\n    case 'json':\r\n      jsonRoute(data);\r\n      break;\r\n    case 'txt':\r\n      txtRoute(`${jsonfile}\\n${data}`);\r\n      break;\r\n    case 'csv':\r\n      csvRoute(jsonfile, data);\r\n      break;\r\n    default:\r\n      console.log(`Unknown file type ${ext}`);\r\n  }\r\n}\r\n","import { Handler, HTMLImportData, UserData } from './importForm';\r\n\r\nexport class ImportGenericForm extends FormApplication {\r\n  _handler: Handler;\r\n  tab: string;\r\n\r\n  constructor({ handler, tab }: { handler: Handler; tab: string }) {\r\n    super({});\r\n    this._handler = handler;\r\n    this.tab = tab;\r\n  }\r\n\r\n  get handler(): Handler {\r\n    return this._handler;\r\n  }\r\n\r\n  set handler(handler) {\r\n    this._handler = handler;\r\n  }\r\n\r\n  async _updateObject(_: Event, formData?: object): Promise<unknown> {\r\n    if (!formData || formData === {}) return;\r\n    const data = formData as HTMLImportData;\r\n    console.log(`data: ${JSON.stringify(data, null, 2)}`);\r\n    this.handler(data as UserData);\r\n    return;\r\n  }\r\n}\r\n","import CONSTANTS from './constants';\r\nimport { Handler } from './importForm';\r\nimport { ImportGenericForm } from './importGenericForm';\r\n\r\nexport class importActorForm extends ImportGenericForm {\r\n  constructor({ handler, tab }: { handler: Handler; tab: string }) {\r\n    super({ handler, tab });\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      jQuery: false,\r\n      width: 400,\r\n      top: window.innerHeight - window.innerHeight + 20,\r\n      left: window.innerWidth - 710,\r\n      template: `modules/${CONSTANTS.module.name}/templates/importActorForm.hbs`,\r\n    });\r\n  }\r\n}\r\n","import CONSTANTS from './constants';\r\nimport { Handler, HTMLImportData, UserData } from './importForm';\r\n\r\nexport class importTableForm extends FormApplication {\r\n  _handler: Handler;\r\n  tab: string;\r\n\r\n  constructor(handler: Handler, tab: string) {\r\n    super({});\r\n    this._handler = handler;\r\n    this.tab = tab;\r\n  }\r\n\r\n  get handler(): Handler {\r\n    return this._handler;\r\n  }\r\n\r\n  set handler(handler) {\r\n    this._handler = handler;\r\n  }\r\n\r\n  async _updateObject(_: Event, formData?: object): Promise<unknown> {\r\n    if (!formData || formData === {}) return;\r\n    const data = formData as HTMLImportData;\r\n    console.log(`data: ${JSON.stringify(data, null, 2)}`);\r\n    this.handler(data as UserData);\r\n    return;\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      jQuery: false,\r\n      width: 400,\r\n      top: window.innerHeight - window.innerHeight + 20,\r\n      left: window.innerWidth - 710,\r\n      template: `modules/${CONSTANTS.module.name}/templates/importTableForm.hbs`,\r\n    });\r\n  }\r\n}\r\n","import CONSTANTS from './constants';\r\nimport { Handler } from './importForm';\r\nimport { ImportGenericForm } from './importGenericForm';\r\n\r\nexport class importItemForm extends ImportGenericForm {\r\n  constructor({ handler, tab }: { handler: Handler; tab: string }) {\r\n    super({ handler, tab });\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      jQuery: false,\r\n      width: 400,\r\n      top: window.innerHeight - window.innerHeight + 20,\r\n      left: window.innerWidth - 710,\r\n      template: `modules/${CONSTANTS.module.name}/templates/importItemForm.hbs`,\r\n    });\r\n  }\r\n}\r\n","import CONSTANTS from './constants';\r\nimport { Handler } from './importForm';\r\nimport { ImportGenericForm } from './importGenericForm';\r\n\r\nexport class importJournalForm extends ImportGenericForm {\r\n  constructor({ handler, tab }: { handler: Handler; tab: string }) {\r\n    super({ handler, tab });\r\n  }\r\n\r\n  static get defaultOptions() {\r\n    return foundry.utils.mergeObject(super.defaultOptions, {\r\n      jQuery: false,\r\n      width: 400,\r\n      top: window.innerHeight - window.innerHeight + 20,\r\n      left: window.innerWidth - 710,\r\n      template: `modules/${CONSTANTS.module.name}/templates/importJournalForm.hbs`,\r\n    });\r\n  }\r\n}\r\n","import { importActorForm as ImportActorForm } from './importActorForm';\r\nimport { importTableForm as ImportTableForm } from './importTableForm';\r\nimport { importItemForm as ImportItemForm } from './importItemForm';\r\n\r\nimport { Handler } from './importForm';\r\nimport { importJournalForm as ImportJournalForm } from './importJournalForm';\r\n\r\nexport function renderSidebarButtons(app: any, tab: string, handler: Handler) {\r\n  const name = tab.charAt(0).toUpperCase() + tab.slice(1);\r\n  const html = app.element;\r\n  \r\n  // Check if button already exists\r\n  if (html.querySelector('#inputButton')) return;\r\n  \r\n  // Create button element\r\n  const button = document.createElement('button');\r\n  button.id = 'inputButton';\r\n  button.style.flexBasis = 'auto';\r\n  button.innerHTML = `<i class=\"fas fa-atlas\"></i> Import ${name}`;\r\n  \r\n  // Find header-actions and append button\r\n  const headerActions = html.querySelector('.header-actions');\r\n  if (!headerActions) return;\r\n  \r\n  headerActions.appendChild(button);\r\n  \r\n  // Add click event listener\r\n  button.addEventListener('click', async (e) => {\r\n    e.preventDefault();\r\n    switch (tab) {\r\n      case 'journal': {\r\n        const form = new ImportJournalForm({ handler, tab });\r\n        form.render(true);\r\n        break;\r\n      }\r\n      case 'tables': {\r\n        const form = new ImportTableForm(handler, tab);\r\n        form.render(true);\r\n        break;\r\n      }\r\n      case 'actors': {\r\n        const form = new ImportActorForm({ handler, tab });\r\n        form.render(true);\r\n        break;\r\n      }\r\n      case 'items': {\r\n        const form = new ImportItemForm({ handler, tab });\r\n        form.render(true);\r\n        break;\r\n      }\r\n      default:\r\n        throw new Error(`Unknown tab: ${tab}`);\r\n    }\r\n  });\r\n}\r\n","export function parseGenericFormula(line: string, regexStart: RegExp) {\r\n  // line: Hit Points 66 (12d8 + 12)\r\n  // get string from between parentheses\r\n  // match = (12d8 + 12),12d8 + 12\r\n  const formulaArray = line.match(/\\(([^)]+)\\)/);\r\n  const regexSplit = line.split(regexStart);\r\n  const beforeRegex = regexSplit[0];\r\n  const afterRegex = regexSplit[1];\r\n  let dieFormula = '';\r\n  let change = '';\r\n  let formula = undefined;\r\n  if (!formulaArray || formulaArray.length < 2) {\r\n    // no parentheses found\r\n  } else {\r\n    // pull formula from match\r\n    formula = formulaArray[1];\r\n\r\n    if (formula.includes('+')) {\r\n      dieFormula = formula.split('+')[0];\r\n      change = formula.split('+')[1];\r\n    } else if (formula.includes('-')) {\r\n      dieFormula = formula.split('-')[0];\r\n      change = '-' + formula.split('-')[1];\r\n    } else {\r\n      dieFormula = formula;\r\n      change = '0';\r\n    }\r\n  }\r\n\r\n  const numOfDice = dieFormula.split('d')[0];\r\n  const dieSize = dieFormula.split('d')[1];\r\n\r\n  // get value after Hit Points string\r\n  const hp = line.match(regexStart) || '10';\r\n  let afterFormula: string | undefined;\r\n  let beforeFormula: string | undefined;\r\n  if (formula) {\r\n    const formulaSplit: string[] = line.split(formula).map((item) => item.replace('(,', '').replace(')', ''));\r\n    afterFormula = formulaSplit[1];\r\n    beforeFormula = formulaSplit[0];\r\n  }\r\n  return {\r\n    value: parseInt(hp[1]),\r\n    min: Number(numOfDice) + Number(change),\r\n    max: Number(numOfDice) * Number(dieSize) + Number(change),\r\n    str: formula,\r\n    afterRegex,\r\n    beforeRegex,\r\n    mod: Number(change),\r\n    afterFormula,\r\n    beforeFormula,\r\n  };\r\n}\r\n","import {\r\n  ActionType,\r\n  Activation,\r\n  ItemType,\r\n  Damage,\r\n  ShortAbility,\r\n  Save,\r\n  Uses,\r\n  Target,\r\n  Recharge,\r\n  UniversalItemType,\r\n} from '../interfaces';\r\n\r\nimport { Range } from '../interfaces';\r\nimport { Feature, SectionLabel } from '../../actor/interfaces';\r\nimport { parseGenericFormula } from '../../actor/parsers/generic';\r\nimport { FifthItemType, FifthItem } from '../../actor/templates/fifthedition';\r\nimport { ItemParserInput } from '../typeGuardParserRunners';\r\n\r\nfunction parseMeasurement(description: string, keyWord: string) {\r\n  const unitText = description.split(keyWord)[0].trim();\r\n  const lastItem = unitText.split(' ').pop() || '';\r\n  return parseInt(lastItem.split('-')[0]);\r\n}\r\n\r\nexport function parseSpellCone(description: string) {\r\n  // like 20-foot-radius sphere\r\n  return parseMeasurement(description, 'cone');\r\n}\r\n\r\nexport function parseSpellSphere(description: string) {\r\n  // like 20-foot-radius sphere\r\n  return parseMeasurement(description, 'radius');\r\n}\r\n\r\nexport function parseRange(description: string): Range | undefined {\r\n  if (/reach/i.test(description)) {\r\n    const stringValue = description.split(/reach/)[1].trim().split(' ')[0];\r\n    const value = parseInt(stringValue);\r\n    if (!isNaN(value)) return { value, units: 'ft' };\r\n  }\r\n  if (/range/i.test(description)) {\r\n    const rangeStr = description.split(/range/i)[1].trim().split(' ')[0];\r\n    const [value, long] = rangeStr.split('/').map((str) => parseInt(str));\r\n    if (isNaN(value)) {\r\n      const rangeRegex = /range (\\d+) ft./;\r\n      const rangeMatch = description.match(rangeRegex);\r\n      if (rangeMatch) {\r\n        const rangeValue = parseInt(rangeMatch[1]);\r\n        if (!isNaN(rangeValue)) return { value: rangeValue, units: 'ft' };\r\n      }\r\n    }\r\n    if (!isNaN(value)) return { value, long, units: 'ft' };\r\n  }\r\n\r\n  if (/cone/i.test(description)) {\r\n    const value = parseSpellCone(description);\r\n    if (!isNaN(value)) return { value, units: 'self' };\r\n  }\r\n\r\n  if (/within/i.test(description)) {\r\n    const rangeStr = description\r\n      .split(/within/i)[1]\r\n      .trim()\r\n      .split('ft')[0]\r\n      .trim();\r\n    const value = parseInt(rangeStr);\r\n    if (!isNaN(value)) {\r\n      return { value, units: 'ft' };\r\n    }\r\n  }\r\n}\r\n\r\nexport function parseDamageType(from: string): string {\r\n  if (from.includes('piercing')) return 'piercing';\r\n  if (from.includes('slashing')) return 'slashing';\r\n  if (from.includes('bludgeoning')) return 'bludgeoning';\r\n  if (from.includes('fire')) return 'fire';\r\n  if (from.includes('cold')) return 'cold';\r\n  if (from.includes('lightning')) return 'lightning';\r\n  if (from.includes('acid')) return 'acid';\r\n  if (from.includes('poison')) return 'poison';\r\n  if (from.includes('psychic')) return 'psychic';\r\n  if (from.includes('radiant')) return 'radiant';\r\n  if (from.includes('thunder')) return 'thunder';\r\n  if (from.includes('force')) return 'force';\r\n  if (from.includes('necrotic')) return 'necrotic';\r\n  if (from.includes('psychic')) return 'psychic';\r\n  throw new Error(`Unable to parse damage type from ${from}`);\r\n}\r\n\r\nexport function parseType(description: string): ItemType {\r\n  // match if (1d8)\r\n  if (isWeaponType(description)) return 'weapon';\r\n  if (/armor/i.test(description)) return 'equipment';\r\n  if (/unil the next dawn/i.test(description)) return 'consumable';\r\n  if (/beginning at/i.test(description)) return 'feat';\r\n  if (/starting at/i.test(description)) return 'feat';\r\n  return 'consumable';\r\n}\r\n\r\nexport function parseActivation(name: string, description: string, section?: SectionLabel): Activation | undefined {\r\n  // cost parsed from something like Wings of Syranita (Costs 2 Actions)\r\n  const costString = name.match(/\\(Costs (\\d+) Actions\\)/);\r\n  const cost = costString ? parseInt(costString[1]) : 1;\r\n  if (section) {\r\n    switch (section) {\r\n      case 'action': {\r\n        return {\r\n          type: 'action',\r\n          cost,\r\n        };\r\n      }\r\n      case 'bonus': {\r\n        return {\r\n          type: 'bonus',\r\n          cost,\r\n        };\r\n      }\r\n      case 'reaction': {\r\n        return {\r\n          type: 'reaction',\r\n          cost,\r\n        };\r\n      }\r\n      case 'legendary': {\r\n        return {\r\n          type: 'legendary',\r\n          cost,\r\n        };\r\n      }\r\n    }\r\n  }\r\n\r\n  if (/attack/i.test(description))\r\n    return {\r\n      type: 'action',\r\n      cost,\r\n    };\r\n\r\n  if (description.includes('action'))\r\n    return {\r\n      type: 'action',\r\n      cost,\r\n    };\r\n  if (description.includes('bonus action'))\r\n    return {\r\n      type: 'bonus',\r\n      cost,\r\n    };\r\n\r\n  if (description.includes('spell save'))\r\n    return {\r\n      type: 'action',\r\n      cost,\r\n    };\r\n  if (description.includes('saving throw'))\r\n    return {\r\n      type: 'action',\r\n      cost,\r\n    };\r\n}\r\n\r\nexport function buildDamageParts(description: string): string[][] {\r\n  // description = 'Melee Weapon Attack: +6 to hit, reach 5 ft., one target.Hit: 8 (1d8 + 4) piercing damage.'\r\n  const uncleanParts = description.split('plus');\r\n  if (!uncleanParts) throw new Error(`Unable to parse damage parts from ${description}`);\r\n  const parts = uncleanParts.map((part) => {\r\n    const parsed = parseGenericFormula(part, /Melee Weapon Attack: +/);\r\n    if (!parsed || !parsed?.str) throw new Error(`Unable to parse damage parts from ${description}`);\r\n    const fromString = parsed.afterFormula ? parsed.afterFormula : part;\r\n    return [parsed.str, parseDamageType(fromString)];\r\n  });\r\n  return parts;\r\n}\r\n\r\n// regex to match a die formula\r\n\r\nexport function isWeaponType(input: string): boolean {\r\n  const dieRegex = /(\\d+d\\d+)/;\r\n  return dieRegex.test(input) && /weapon/i.test(input);\r\n}\r\n\r\n// the logic for parsing type is different if it is sourced from a monster\r\nexport function parseTypeFromActorFeature(input: string): ItemType {\r\n  if (isWeaponType(input)) return 'weapon';\r\n  if (/weapon attack:/i.test(input)) return 'weapon';\r\n  if (/spell attack/i.test(input)) return 'spell';\r\n  if (/beginning at/i.test(input)) return 'feat';\r\n  if (/starting at/i.test(input)) return 'feat';\r\n  return 'feat';\r\n}\r\n\r\nexport function parseActionType(description: string): ActionType {\r\n  if (/melee/i.test(description)) return 'mwak';\r\n  if (/ranged/i.test(description)) return 'rwak';\r\n  if (/spell save/i.test(description)) return 'save';\r\n  if (/saving throw/i.test(description)) return 'save';\r\n  throw new Error(`Could not parse action type from ${description}`);\r\n}\r\n\r\nexport function parsePossibleActionType(description: string): ActionType | undefined {\r\n  if (/Melee Weapon Attack/.test(description)) return 'mwak';\r\n  if (/Ranged Weapon Attack/.test(description)) return 'rwak';\r\n  if (/spell save/i.test(description)) return 'save';\r\n  if (/saving throw/i.test(description)) return 'save';\r\n  return;\r\n}\r\n\r\nfunction abilityToLongShort(ability: string) {\r\n  if (/str/i.test(ability)) return ['str', 'strength'];\r\n  if (/dex/i.test(ability)) return ['dex', 'dexterity'];\r\n  if (/con/i.test(ability)) return ['con', 'constitution'];\r\n  if (/int/i.test(ability)) return ['int', 'intelligence'];\r\n  if (/wis/i.test(ability)) return ['wis', 'wisdom'];\r\n  if (/cha/i.test(ability)) return ['cha', 'charisma'];\r\n  return ['', ''];\r\n}\r\nexport function actionTypeExtraData(actionType: string | undefined, { description }: Feature) {\r\n  let building = {};\r\n  if (!actionType) return building;\r\n  if (actionType === 'save') {\r\n    const dc = description.split('DC')[1].trim().split(' ')[0].trim();\r\n    const uncleanAbility = description.split(dc)[1].trim().split(' ')[0].trim();\r\n    const [short] = abilityToLongShort(uncleanAbility);\r\n    building = {\r\n      ...building,\r\n      ability: short,\r\n      save: {\r\n        ability: short,\r\n        dc: parseInt(dc),\r\n        scaling: 'spell',\r\n      },\r\n    };\r\n  }\r\n\r\n  return building;\r\n}\r\n\r\n/**\r\n * @param name the name of the spell\r\n * @param description the description of the spell\r\n * @returns { value: number, charged: boolean }\r\n *\r\n * @example\r\n * parseSpell('Poison Breath (Recharge 5-6)', 'A poisonous gas cloud spreads from the dragon\\'s mouth,\r\n */\r\nfunction parseRecharge(name: string): Recharge {\r\n  if (!name.toLowerCase().includes('recharge')) {\r\n    throw new Error(`${name} is not a recharge spell`);\r\n  }\r\n  const [, recharge] = name.toLowerCase().split('recharge');\r\n\r\n  let range: string[] = [];\r\n  if (recharge.includes('-')) {\r\n    range = recharge.split('-');\r\n  } else if (recharge.includes('–')) {\r\n    range = recharge.split('–');\r\n  }\r\n  const [lower, upper] = range;\r\n  return {\r\n    value: parseInt(lower),\r\n    charged: upper ? true : false,\r\n  };\r\n}\r\n\r\nexport function parseUses(name: string, description: string): Uses | undefined {\r\n  function parseDay(from: string): Uses | undefined {\r\n    const perDay = parseInt(from.split('/')[0].split('(')[1]);\r\n    if (isNaN(perDay)) return;\r\n    return {\r\n      per: 'day',\r\n      value: perDay,\r\n      max: perDay,\r\n    };\r\n  }\r\n  if (/\\/day/i.test(name)) {\r\n    return parseDay(name);\r\n  }\r\n\r\n  if (/\\/day/i.test(description)) {\r\n    return parseDay(description);\r\n  }\r\n}\r\n\r\nfunction parseTarget(description: string): Target {\r\n  if (/radius/i.test(description)) {\r\n    return {\r\n      type: 'sphere',\r\n      value: parseSpellSphere(description),\r\n      units: 'ft',\r\n    };\r\n  }\r\n\r\n  if (/cone/i.test(description)) {\r\n    return {\r\n      type: 'cone',\r\n      value: parseSpellCone(description),\r\n      units: 'ft',\r\n    };\r\n  }\r\n  throw new Error(`Unable to parse target from ${description}`);\r\n}\r\n\r\nexport function parseToItem({ name, description, ability, section }: ItemParserInput): UniversalItemType {\r\n  const itemType: FifthItemType = parseTypeFromActorFeature(description);\r\n  let damage: undefined | Damage = undefined;\r\n  try {\r\n    damage = { parts: buildDamageParts(description) };\r\n  } catch (_) {\r\n    // spell doesn't require damage\r\n  }\r\n  const actionType = parsePossibleActionType(description);\r\n\r\n  let save: Save | undefined = undefined;\r\n  if (actionType === 'save') {\r\n    const rawDC = description?.split('DC')[1]?.trim()?.split(' ')[0]?.trim() ?? '';\r\n    const uncleanAbility = description?.split(rawDC)[1]?.trim()?.split(' ')[0]?.trim() ?? '';\r\n    const [short] = abilityToLongShort(uncleanAbility);\r\n    ability = short as ShortAbility;\r\n    if (!rawDC) save = undefined;\r\n    else {\r\n      save = {\r\n        ability: short,\r\n        dc: parseInt(rawDC),\r\n        scaling: 'flat',\r\n      };\r\n    }\r\n  }\r\n\r\n  let uses;\r\n  try {\r\n    uses = parseUses(name, description);\r\n  } catch (_) {\r\n    // uses can be undefined\r\n  }\r\n\r\n  let recharge;\r\n  try {\r\n    recharge = parseRecharge(name);\r\n  } catch (_) {\r\n    // recharge can be undefined\r\n  }\r\n\r\n  let target;\r\n  try {\r\n    target = parseTarget(description);\r\n  } catch (_) {\r\n    // target can be undefined\r\n  }\r\n\r\n  let range;\r\n  try {\r\n    range = parseRange(description);\r\n  } catch (_) {\r\n    // range can be undefined\r\n  }\r\n  return {\r\n    name,\r\n    type: itemType,\r\n    ability,\r\n    uses,\r\n    save,\r\n    recharge,\r\n    description,\r\n    activation: parseActivation(name, description, section),\r\n    damage,\r\n    actionType,\r\n    range,\r\n    attackBonus: 0,\r\n    target,\r\n  };\r\n}\r\n\r\nexport function parsedToWeapon(name: string, inputDescription: string, inputAbility?: string): FifthItem {\r\n  const parsedWeapon = parseToItem({ name, description: inputDescription, ability: inputAbility as ShortAbility });\r\n  const { type, description, activation, damage, actionType, range, ability, attackBonus } = parsedWeapon;\r\n  return {\r\n    name,\r\n    type,\r\n    data: {\r\n      description: {\r\n        value: description,\r\n      },\r\n      activation,\r\n      damage,\r\n      actionType,\r\n      range,\r\n      ability,\r\n      attackBonus: attackBonus?.toString(),\r\n    },\r\n  };\r\n}\r\n","import { FifthItem, ItemRarity } from '../actor/templates/fifthedition';\r\nimport { ItemType } from './interfaces';\r\nimport { parsedToWeapon, parseType } from './parsers/textBlock';\r\n\r\ninterface ItemData {\r\n  description: {\r\n    value: string;\r\n  };\r\n  rarity: ItemRarity;\r\n}\r\n\r\nexport interface Item {\r\n  name: string;\r\n  type: ItemType;\r\n  data: ItemData;\r\n}\r\n\r\nfunction parseName(input: string): string {\r\n  return input.split('\\n')[0].trim();\r\n}\r\n\r\nfunction parseRarity(input: string): ItemRarity {\r\n  if (/uncommon/i.test(input)) return 'uncommon';\r\n  if (/common/i.test(input)) return 'common';\r\n  if (/rare/i.test(input)) return 'rare';\r\n  if (/legendary/i.test(input)) return 'legendary';\r\n  return 'common';\r\n}\r\n\r\nfunction cleanDescription(description: string, extraItems: string[]): string {\r\n  return (\r\n    extraItems\r\n      .reduce((acc, item) => {\r\n        const afterItem = acc.split(item)[1] || acc;\r\n        return afterItem;\r\n      }, description)\r\n      .replace(/(\\r\\n|\\n|\\r)/gm, ' ')\r\n      .trim() || description\r\n  );\r\n}\r\n\r\nexport function processItem(input: string): FifthItem {\r\n  const type = parseType(input);\r\n  const name = parseName(input);\r\n  const rarity = parseRarity(input);\r\n  // TODO: fix issue where type and rarity and such are still in the description\r\n  const description = cleanDescription(input, [name, type, rarity]);\r\n  switch (type) {\r\n    case 'weapon':\r\n    case 'feat':\r\n      return parsedToWeapon(name, description);\r\n    default:\r\n      return {\r\n        name,\r\n        type,\r\n        data: {\r\n          description: {\r\n            value: description,\r\n          },\r\n          rarity,\r\n        },\r\n      };\r\n  }\r\n}\r\n","import { UserData } from '../importForm';\r\nimport { processItem } from './process';\r\n\r\nasync function handleInput(input: string) {\r\n  const parsedItem = processItem(input);\r\n  await Item.create({ ...parsedItem });\r\n}\r\n\r\nexport async function processItemInput({ jsonfile, clipboardInput }: UserData) {\r\n  if (clipboardInput) {\r\n    console.log(`Cliboard input: ${clipboardInput}`);\r\n    handleInput(clipboardInput);\r\n  }\r\n}\r\n","import { SectionLabel } from '../../actor/interfaces';\r\nimport { ImportItem, ShortAbility } from '../interfaces';\r\nimport { parseToItem } from './textBlock';\r\n\r\nexport const parseItem = ({\r\n  name,\r\n  description,\r\n  ability,\r\n  section,\r\n}: {\r\n  name: string;\r\n  description: string;\r\n  ability?: ShortAbility;\r\n  section?: SectionLabel;\r\n}): ImportItem => {\r\n  try {\r\n    const item = parseToItem({ name, description, ability, section });\r\n    return item;\r\n  } catch (e) {\r\n    console.log(`Error parsing item: ${name} - ${e}`);\r\n    throw new Error(`Failed to parse item: ${name}`);\r\n  }\r\n};\r\n","import { FifthItemData } from '../../item/compendium/interfaces';\r\n\r\nexport interface FifthAbilities {\r\n  str: {\r\n    value: number;\r\n    proficient: number;\r\n    saveBonus?: number;\r\n    bonuses?: {\r\n      check?: string;\r\n      save?: string;\r\n    };\r\n  };\r\n  dex: {\r\n    value: number;\r\n    proficient: number;\r\n    saveBonus?: number;\r\n    bonuses?: {\r\n      check?: string;\r\n      save?: string;\r\n    };\r\n  };\r\n  con: {\r\n    value: number;\r\n    proficient: number;\r\n    saveBonus?: number;\r\n    bonuses?: {\r\n      check?: string;\r\n      save?: string;\r\n    };\r\n  };\r\n  int: {\r\n    value: number;\r\n    proficient: number;\r\n    saveBonus?: number;\r\n    bonuses?: {\r\n      check?: string;\r\n      save?: string;\r\n    };\r\n  };\r\n  wis: {\r\n    value: number;\r\n    proficient: number;\r\n    saveBonus?: number;\r\n    bonuses?: {\r\n      check?: string;\r\n      save?: string;\r\n    };\r\n  };\r\n  cha: {\r\n    value: number;\r\n    proficient: number;\r\n    saveBonus?: number;\r\n    bonuses?: {\r\n      check?: string;\r\n      save?: string;\r\n    };\r\n  };\r\n}\r\n\r\nexport interface FifthAttributes {\r\n  ac: {\r\n    flat: number;\r\n    calc?: string;\r\n    formula?: string;\r\n  };\r\n  hp: {\r\n    value: number;\r\n    min?: number;\r\n    max?: number;\r\n    temp?: number;\r\n    tempmax?: number;\r\n    formula?: string;\r\n  };\r\n  init?: {\r\n    value: number;\r\n    bonus: number;\r\n  };\r\n  movement: {\r\n    burrow?: number;\r\n    climb?: number;\r\n    fly?: number;\r\n    swim?: number;\r\n    walk: number;\r\n    units: 'ft';\r\n    hover?: boolean;\r\n  };\r\n  senses: {\r\n    darkvision?: number;\r\n    blindsight?: number;\r\n    tremorsense?: number;\r\n    truesight?: number;\r\n    special?: string;\r\n    units?: 'ft';\r\n  };\r\n}\r\n\r\nexport type FifthStat = 'dex' | 'wis' | 'int' | 'str' | 'cha' | 'con';\r\nexport interface FifthSkill {\r\n  value?: number;\r\n  ability: FifthStat;\r\n  bonus?: number;\r\n  mod?: number;\r\n  passive?: number;\r\n  prof?: number;\r\n  total?: number;\r\n}\r\n\r\nexport interface FifthSkills {\r\n  acr?: FifthSkill;\r\n  ani?: FifthSkill;\r\n  arc?: FifthSkill;\r\n  ath?: FifthSkill;\r\n  dec?: FifthSkill;\r\n  his?: FifthSkill;\r\n  ins?: FifthSkill;\r\n  itm?: FifthSkill;\r\n  inv?: FifthSkill;\r\n  med?: FifthSkill;\r\n  nat?: FifthSkill;\r\n  prc?: FifthSkill;\r\n  prf?: FifthSkill;\r\n  per?: FifthSkill;\r\n  rel?: FifthSkill;\r\n  slt?: FifthSkill;\r\n  ste?: FifthSkill;\r\n  sur?: FifthSkill;\r\n}\r\n\r\nexport interface FifthItemDamage {\r\n  parts: string[][];\r\n  versatile?: string;\r\n}\r\n\r\nexport type ItemRarity = 'common' | 'uncommon' | 'rare' | 'legendary';\r\nexport type FifthFeatureCost = 'action' | 'bonus' | 'reaction' | 'legendary' | 'spell' | 'weapon' | 'none';\r\nexport type FifthItemType =\r\n  | 'weapon'\r\n  | 'equipment'\r\n  | 'consumable'\r\n  | 'tool'\r\n  | 'loot'\r\n  | 'class'\r\n  | 'spell'\r\n  | 'feat'\r\n  | 'backpack';\r\n\r\nexport type ActionType = 'mwak' | 'rwak' | 'save' | undefined;\r\n\r\nexport interface FifthItem {\r\n  name: string;\r\n  type: FifthItemType;\r\n  img?: string;\r\n  data: FifthItemData;\r\n  /* {\r\n    description?: {\r\n      value: string;\r\n      chat?: string;\r\n      unidentified?: string;\r\n    };\r\n    source?: string;\r\n    activation?: {\r\n      type: FifthFeatureCost;\r\n      cost?: number;\r\n      condition?: string;\r\n    };\r\n    damage?: {\r\n      parts?: (string | undefined)[][];\r\n    };\r\n    actionType?: ActionType;\r\n    duration?: {\r\n      value: number;\r\n      units: string;\r\n    };\r\n    range?: {\r\n      value?: number;\r\n      units?: string;\r\n      long?: number;\r\n    };\r\n    save?: {\r\n      ability?: string;\r\n      dc?: number;\r\n      scaling?: string;\r\n    };\r\n    uses?: {\r\n      value?: number;\r\n      per?: string;\r\n      max?: number;\r\n    };\r\n    ability?: string | undefined;\r\n    attackBonus?: number;\r\n    rarity?: ItemRarity;\r\n    target?: {\r\n      value: number;\r\n      width?: number;\r\n      units?: string;\r\n      type: 'creature' | 'point' | 'self' | 'touch' | 'none';\r\n    };\r\n  }; */\r\n}\r\n\r\nexport interface FifthEditionActor {\r\n  abilities: FifthAbilities;\r\n  attributes: FifthAttributes;\r\n  details?: {\r\n    biography: {\r\n      value?: string;\r\n      public?: string;\r\n    };\r\n  };\r\n  traits?: {\r\n    languages: {\r\n      value: string[];\r\n    };\r\n    size?: 'med' | 'large' | 'tiny';\r\n    di?: {\r\n      value: string[];\r\n      custom?: string;\r\n    };\r\n    dr?: {\r\n      value?: string[];\r\n      custom?: string;\r\n    };\r\n    ci?: {\r\n      value: string[];\r\n      custom?: string;\r\n    };\r\n    cr?: {\r\n      value?: string[];\r\n      custom?: string;\r\n    };\r\n  };\r\n  skills: FifthSkills;\r\n}\r\n\r\nexport type SpellSlotKey =\r\n  | 'spell1'\r\n  | 'spell2'\r\n  | 'spell3'\r\n  | 'spell4'\r\n  | 'spell5'\r\n  | 'spell6'\r\n  | 'spell7'\r\n  | 'spell8'\r\n  | 'spell9'\r\n  | 'pact';\r\n\r\ninterface SpellSlotValue {\r\n  value?: string | null;\r\n  override?: string | null;\r\n  max?: string | null;\r\n  level?: string | null;\r\n}\r\n\r\nexport type SpellSlots = Record<SpellSlotKey, SpellSlotValue>;\r\n\r\n// type guard for SpellSlotKey\r\nexport function isSpellSlotKey(key: string): key is SpellSlotKey {\r\n  return (\r\n    key === 'spell1' ||\r\n    key === 'spell2' ||\r\n    key === 'spell3' ||\r\n    key === 'spell4' ||\r\n    key === 'spell5' ||\r\n    key === 'spell6' ||\r\n    key === 'spell7' ||\r\n    key === 'spell8' ||\r\n    key === 'spell9' ||\r\n    key === 'pact'\r\n  );\r\n}\r\n\r\nexport function getDefaultSpellSlots(): SpellSlots {\r\n  const defaultSpellSlots: SpellSlots = {\r\n    spell1: {\r\n      value: '0',\r\n      override: '0',\r\n      max: '0',\r\n    },\r\n    spell2: {\r\n      value: '0',\r\n      override: '0',\r\n      max: '0',\r\n    },\r\n    spell3: {\r\n      value: '0',\r\n      override: '0',\r\n      max: '0',\r\n    },\r\n    spell4: {\r\n      value: '0',\r\n      override: '0',\r\n      max: '0',\r\n    },\r\n    spell5: {\r\n      value: '0',\r\n      override: '0',\r\n      max: '0',\r\n    },\r\n    spell6: {\r\n      value: '0',\r\n      override: '0',\r\n      max: '0',\r\n    },\r\n    spell7: {\r\n      value: '0',\r\n      override: '0',\r\n      max: '0',\r\n    },\r\n    spell8: {\r\n      value: '0',\r\n      override: '0',\r\n      max: '0',\r\n    },\r\n    spell9: {\r\n      value: '0',\r\n      override: '0',\r\n      max: '0',\r\n    },\r\n    pact: {\r\n      value: '0',\r\n      override: '0',\r\n      max: '0',\r\n      level: '0',\r\n    },\r\n  };\r\n  return defaultSpellSlots;\r\n}\r\n","import {\r\n  Abilities,\r\n  ArmorClass,\r\n  ConditionTypes,\r\n  DamageType,\r\n  Feature,\r\n  Health,\r\n  ImportActor,\r\n  Senses,\r\n  Skill,\r\n  Size,\r\n  DamageTypes,\r\n  ImportSpells,\r\n} from './interfaces';\r\nimport {\r\n  FifthAbilities,\r\n  FifthAttributes,\r\n  FifthItem,\r\n  FifthSkill,\r\n  FifthSkills,\r\n  FifthStat,\r\n  getDefaultSpellSlots,\r\n  isSpellSlotKey,\r\n  SpellSlots,\r\n} from './templates/fifthedition';\r\n\r\nexport function convertAbilities({ str, dex, con, int, wis, cha }: Abilities): FifthAbilities {\r\n  return {\r\n    str: {\r\n      value: str.value,\r\n      proficient: 0,\r\n      bonuses: {\r\n        save: `${str.savingThrow}`,\r\n      },\r\n    },\r\n    dex: {\r\n      value: dex.value,\r\n      proficient: 0,\r\n      saveBonus: dex.savingThrow,\r\n      bonuses: {\r\n        save: `${dex.savingThrow}`,\r\n      },\r\n    },\r\n    con: {\r\n      value: con.value,\r\n      proficient: 0,\r\n      saveBonus: con.savingThrow,\r\n      bonuses: {\r\n        save: `${con.savingThrow}`,\r\n      },\r\n    },\r\n    int: {\r\n      value: int.value,\r\n      proficient: 0,\r\n      saveBonus: int.savingThrow,\r\n      bonuses: {\r\n        save: `${int.savingThrow}`,\r\n      },\r\n    },\r\n    wis: {\r\n      value: wis.value,\r\n      proficient: 0,\r\n      saveBonus: wis.savingThrow,\r\n      bonuses: {\r\n        save: `${wis.savingThrow}`,\r\n      },\r\n    },\r\n    cha: {\r\n      value: cha.value,\r\n      proficient: 0,\r\n      saveBonus: cha.savingThrow,\r\n      bonuses: {\r\n        save: `${cha.savingThrow}`,\r\n      },\r\n    },\r\n  };\r\n}\r\n\r\nfunction acToFifth({ value, type }: ArmorClass) {\r\n  const flat = value;\r\n  let calc = 'flat';\r\n  if (type.match(/natural armor/i)) {\r\n    calc = 'natural';\r\n  } else if (type.match(/leather armor/i)) {\r\n    calc = 'equipped';\r\n  } else if (type.match(/plate armor/i)) {\r\n    calc = 'equipped';\r\n  } else if (type.match(/mail armor/i)) {\r\n    calc = 'equipped';\r\n  }\r\n  return {\r\n    calc,\r\n    flat,\r\n  };\r\n}\r\n\r\ninterface Attributes {\r\n  armorClass: ArmorClass;\r\n  health: Health;\r\n  speed: number;\r\n}\r\nfunction convertAttributes({ armorClass, health, speed }: Attributes, senses: Senses): FifthAttributes {\r\n  return {\r\n    senses: {\r\n      darkvision: senses?.darkvision,\r\n      blindsight: senses?.blindsight,\r\n      tremorsense: senses?.tremorsense,\r\n      truesight: senses?.truesight,\r\n      special: senses?.special,\r\n      units: 'ft',\r\n    },\r\n    ac: acToFifth(armorClass),\r\n    hp: {\r\n      value: health.value,\r\n      max: health.value,\r\n      min: 0,\r\n      formula: health?.formula,\r\n    },\r\n    movement: {\r\n      units: 'ft',\r\n      walk: speed,\r\n    },\r\n  };\r\n}\r\n\r\nfunction buildSkill(skill: Skill, ability: FifthStat): FifthSkill {\r\n  const fifthSkill: FifthSkill = {\r\n    value: skill.bonus ? 1 : 0,\r\n    mod: skill.bonus,\r\n    total: skill.bonus,\r\n    ability,\r\n  };\r\n  return fifthSkill;\r\n}\r\n\r\nfunction convertSkills(skills: Skill[], senses: Senses): FifthSkills {\r\n  const fifthSkills: FifthSkills = {};\r\n  skills.forEach((skill) => {\r\n    const skillName = skill.name.toLowerCase().trim();\r\n    switch (skillName) {\r\n      case 'acrobatics':\r\n        fifthSkills.acr = buildSkill(skill, 'dex');\r\n        break;\r\n      case 'animal handling':\r\n        fifthSkills.ani = buildSkill(skill, 'wis');\r\n        break;\r\n      case 'arcana':\r\n        fifthSkills.arc = buildSkill(skill, 'int');\r\n        break;\r\n      case 'athletics':\r\n        fifthSkills.ath = buildSkill(skill, 'str');\r\n        break;\r\n      case 'deception':\r\n        fifthSkills.dec = buildSkill(skill, 'cha');\r\n        break;\r\n      case 'history':\r\n        fifthSkills.his = buildSkill(skill, 'int');\r\n        break;\r\n      case 'insight':\r\n        fifthSkills.ins = buildSkill(skill, 'wis');\r\n        break;\r\n      case 'intimidation':\r\n        fifthSkills.itm = buildSkill(skill, 'str');\r\n        break;\r\n      case 'investigation':\r\n        fifthSkills.inv = buildSkill(skill, 'int');\r\n        break;\r\n      case 'medicine':\r\n        fifthSkills.med = buildSkill(skill, 'wis');\r\n        break;\r\n      case 'nature':\r\n        fifthSkills.nat = buildSkill(skill, 'int');\r\n        break;\r\n      case 'perception':\r\n        fifthSkills.prc = buildSkill(skill, 'wis');\r\n        fifthSkills.prc.passive = senses.passivePerception;\r\n        break;\r\n      case 'performance':\r\n        fifthSkills.prf = buildSkill(skill, 'cha');\r\n        break;\r\n      case 'persuasion':\r\n        fifthSkills.per = buildSkill(skill, 'cha');\r\n        break;\r\n      case 'religion':\r\n        fifthSkills.rel = buildSkill(skill, 'int');\r\n        break;\r\n      case 'sleight of hand':\r\n        fifthSkills.slt = buildSkill(skill, 'dex');\r\n        break;\r\n      case 'stealth':\r\n        fifthSkills.ste = buildSkill(skill, 'dex');\r\n        break;\r\n      case 'survival':\r\n        fifthSkills.sur = buildSkill(skill, 'wis');\r\n        break;\r\n      default:\r\n        break;\r\n    }\r\n  });\r\n  return fifthSkills;\r\n}\r\n\r\nexport function buildAttackBonus(description: string, mod: number): number | undefined {\r\n  // regex for + followed by one or two digits\r\n  const attackMatch = description.match(/\\+\\d{1,2}/);\r\n  if (attackMatch) {\r\n    const attackBonus = parseInt(attackMatch[0].substring(1), 0);\r\n    return attackBonus - mod;\r\n  }\r\n}\r\n\r\nexport function buildReach(description: string) {\r\n  if (!description.includes('reach')) return undefined;\r\n  const typeSplit = description.split('reach');\r\n  let type = 'ft';\r\n  let value = '5';\r\n  if (typeSplit) {\r\n    const raw = typeSplit[1].split(',');\r\n    if (raw) {\r\n      const reachString = raw[0].trim();\r\n      // pull out the number\r\n      const number = reachString.match(/\\d+/);\r\n      // pull out the units\r\n      const units = reachString.match(/[a-zA-Z]+/);\r\n      if (number && units) {\r\n        value = number[0];\r\n        type = units[0];\r\n      }\r\n    }\r\n  }\r\n  return {\r\n    value: Number(value),\r\n    units: type,\r\n  };\r\n}\r\n\r\nexport interface FeatureCollection {\r\n  features: Feature[];\r\n  actions: Feature[];\r\n  reactions?: Feature[];\r\n}\r\n\r\nexport function getMaxAbility(abilities: Abilities): FifthStat {\r\n  if (abilities.str.mod > abilities.dex.mod) return 'str';\r\n  return 'dex';\r\n}\r\n\r\nfunction convertSize(size: Size) {\r\n  if (size === 'Tiny') return 'tiny';\r\n  if (size === 'Small') return 'sm';\r\n  if (size === 'Medium') return 'med';\r\n  if (size === 'Large') return 'lg';\r\n  if (size === 'Huge') return 'huge';\r\n  if (size === 'Gargantuan') return 'grg';\r\n  return 'med';\r\n}\r\n\r\nfunction convertType(input: string) {\r\n  const type = input.toLowerCase();\r\n  let monsterType = 'unknown';\r\n  if (/aberration/i.test(type)) monsterType = 'aberration';\r\n  if (/beast/i.test(type)) monsterType = 'beast';\r\n  if (/celestial/i.test(type)) monsterType = 'celestial';\r\n  if (/construct/i.test(type)) monsterType = 'construct';\r\n  if (/dragon/i.test(type)) monsterType = 'dragon';\r\n  if (/elemental/i.test(type)) monsterType = 'elemental';\r\n  if (/fey/i.test(type)) monsterType = 'fey';\r\n  if (/fiend/i.test(type)) monsterType = 'fiend';\r\n  if (/giant/i.test(type)) monsterType = 'giant';\r\n  if (/humanoid/i.test(type)) monsterType = 'humanoid';\r\n  if (/monstrosity/i.test(type)) monsterType = 'monstrosity';\r\n  if (/ooze/i.test(type)) monsterType = 'ooze';\r\n  if (/plant/i.test(type)) monsterType = 'plant';\r\n  if (/undead/i.test(type)) monsterType = 'undead';\r\n  if (monsterType === 'unknown') {\r\n    if (/warforged/i.test(type)) monsterType = 'humanoid';\r\n    return {\r\n      value: monsterType,\r\n      subtype: '',\r\n      swarm: '',\r\n      custom: type.toLowerCase(),\r\n    };\r\n  } else {\r\n    return {\r\n      value: monsterType.toLowerCase(),\r\n      subtype: '',\r\n      swarm: '',\r\n      custom: '',\r\n    };\r\n  }\r\n}\r\n\r\nfunction convertLanguage(language: string) {\r\n  if (language === \"thieves' cant\") return 'cant';\r\n  if (language === 'deep speech') return 'deep';\r\n  return language;\r\n}\r\n\r\nfunction buildResistances(\r\n  damageImmunities: DamageType[],\r\n  conditionImmunities: ConditionTypes,\r\n  damageResistances: DamageTypes,\r\n  damageVulnerabilities: DamageTypes,\r\n) {\r\n  let resistances = {};\r\n  if (damageImmunities.length > 0) {\r\n    resistances = {\r\n      ...resistances,\r\n      di: { value: damageImmunities },\r\n    };\r\n  }\r\n\r\n  if (conditionImmunities.length > 0) {\r\n    resistances = {\r\n      ...resistances,\r\n      ci: { value: conditionImmunities },\r\n    };\r\n  }\r\n  if (damageResistances.length > 0) {\r\n    resistances = {\r\n      ...resistances,\r\n      dr: { value: damageResistances },\r\n    };\r\n  }\r\n  if (damageVulnerabilities.length > 0) {\r\n    resistances = {\r\n      ...resistances,\r\n      dv: { value: damageVulnerabilities },\r\n    };\r\n  }\r\n  return resistances;\r\n}\r\n\r\nexport function actorToFifth({\r\n  abilities,\r\n  armorClass,\r\n  health,\r\n  speed,\r\n  biography,\r\n  skills,\r\n  rating,\r\n  damageImmunities,\r\n  damageResistances,\r\n  conditionImmunities,\r\n  damageVulnerabilities,\r\n  size,\r\n  senses,\r\n  languages,\r\n  alignment,\r\n  type,\r\n  spellcasting,\r\n}: ImportActor) {\r\n  return {\r\n    abilities: convertAbilities(abilities),\r\n    attributes: convertAttributes({ armorClass, health, speed }, senses),\r\n    details: {\r\n      race: type,\r\n      alignment,\r\n      type: convertType(type),\r\n      biography: {\r\n        value: biography,\r\n      },\r\n      cr: rating?.cr,\r\n      xp: {\r\n        value: rating?.xp,\r\n      },\r\n    },\r\n    traits: {\r\n      size: convertSize(size),\r\n      languages: {\r\n        value: languages.map(convertLanguage),\r\n      },\r\n      ...buildResistances(damageImmunities, conditionImmunities, damageResistances, damageVulnerabilities),\r\n    },\r\n    skills: convertSkills(skills, senses),\r\n    spellcasting,\r\n    spells: {},\r\n  };\r\n}\r\n\r\nexport function spellsToSpellSlots(spells: ImportSpells, fifthSpells: FifthItem[]): SpellSlots {\r\n  const defaultSlots: SpellSlots = getDefaultSpellSlots();\r\n\r\n  // remove atWill spells from the list as they dont count towards slots\r\n  const spellsToCount = spells.filter((s) => !s.uses?.atWill);\r\n\r\n  spellsToCount.forEach((spell) => {\r\n    const spellLevel = fifthSpells.find((s) => s.name === spell.name)?.data.level;\r\n    const spellSlotKey = `spell${spellLevel}`;\r\n    if (!spellLevel || !isSpellSlotKey(spellSlotKey) || !defaultSlots[spellSlotKey]) return;\r\n\r\n    // spells are 1/day each etc, so we need to sum the uses\r\n    const oldValue = defaultSlots[spellSlotKey].value ?? '0';\r\n    const newValue = spell.uses?.value?.toString() || '0';\r\n    const addedValue = Number(newValue) + Number(oldValue);\r\n    const value = addedValue.toString() || '0';\r\n    defaultSlots[spellSlotKey] = {\r\n      value,\r\n      max: value,\r\n      override: value,\r\n    };\r\n  });\r\n\r\n  return defaultSlots;\r\n}\r\n","import { ImportItem } from '../item/interfaces';\r\n\r\nexport interface Ability {\r\n  value: number;\r\n  mod: number;\r\n  savingThrow: number;\r\n}\r\n\r\nexport type Languages = string[];\r\n\r\nexport interface Abilities {\r\n  str: Ability;\r\n  dex: Ability;\r\n  con: Ability;\r\n  int: Ability;\r\n  wis: Ability;\r\n  cha: Ability;\r\n}\r\n\r\n// For this type guard, we are okay with an any\r\n// eslint-disable-next-line\r\nexport function isAbilities(obj: any): obj is Abilities {\r\n  // make sure str.value, dex.value, etc. are all numbers (not NaN)\r\n  const hasKeys = 'str' in obj && 'dex' in obj && 'con' in obj && 'int' in obj && 'wis' in obj && 'cha' in obj;\r\n  if (!hasKeys) return false;\r\n  if (\r\n    isNaN(obj.str.value) ||\r\n    isNaN(obj.dex.value) ||\r\n    isNaN(obj.con.value) ||\r\n    isNaN(obj.int.value) ||\r\n    isNaN(obj.wis.value) ||\r\n    isNaN(obj.cha.value)\r\n  ) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nexport interface Skill {\r\n  name: string;\r\n  bonus: number;\r\n}\r\n\r\nexport interface Group {\r\n  name: string;\r\n  collection: string[];\r\n}\r\n\r\nexport interface ArmorClass {\r\n  value: number;\r\n  type: string;\r\n}\r\n\r\nexport type SectionLabel = 'action' | 'bonus' | 'reaction' | 'legendary';\r\nexport interface Feature {\r\n  name: string;\r\n  description: string;\r\n  section?: SectionLabel;\r\n}\r\n\r\nexport type Features = Feature[];\r\n\r\nexport interface Health {\r\n  value: number;\r\n  min: number;\r\n  max: number;\r\n  formula?: string;\r\n}\r\n\r\nexport interface Rating {\r\n  cr?: number;\r\n  xp: number;\r\n}\r\n\r\nexport type DamageType =\r\n  | 'poison'\r\n  | 'disease'\r\n  | 'magic'\r\n  | 'psychic'\r\n  | 'radiant'\r\n  | 'necrotic'\r\n  | 'bludgeoning'\r\n  | 'piercing'\r\n  | 'slashing'\r\n  | 'acid'\r\n  | 'cold'\r\n  | 'fire'\r\n  | 'force'\r\n  | 'lightning'\r\n  | 'necrotic'\r\n  | 'psychic'\r\n  | 'radiant'\r\n  | 'thunder';\r\nexport type DamageTypes = DamageType[];\r\n\r\nexport type ConditionType =\r\n  | 'blinded'\r\n  | 'charmed'\r\n  | 'deafened'\r\n  | 'exhaustion'\r\n  | 'frightened'\r\n  | 'grappled'\r\n  | 'incapacitated'\r\n  | 'invisible'\r\n  | 'paralyzed'\r\n  | 'petrified'\r\n  | 'poisoned'\r\n  | 'prone'\r\n  | 'restrained'\r\n  | 'stunned'\r\n  | 'unconscious';\r\nexport type ConditionTypes = ConditionType[];\r\n\r\nexport interface Senses {\r\n  darkvision?: number;\r\n  blindsight?: number;\r\n  tremorsense?: number;\r\n  truesight?: number;\r\n  units: string;\r\n  special?: string;\r\n  passivePerception?: number;\r\n}\r\n\r\nexport type Size = 'Tiny' | 'Small' | 'Medium' | 'Large' | 'Huge' | 'Gargantuan';\r\n\r\nexport type Name = string;\r\nexport type ActorType = string;\r\nexport type Alignment = string;\r\nexport type Biography = string;\r\nexport type Speed = number;\r\nexport type ImportItems = ImportItem[];\r\nexport interface ImportSpell {\r\n  name: string;\r\n  uses: {\r\n    value?: number;\r\n    max?: number;\r\n    per?: string;\r\n    atWill?: boolean;\r\n  };\r\n  type: 'spell';\r\n}\r\nexport type ImportSpells = ImportSpell[];\r\n\r\nexport type ImportSpellcasting = string | undefined;\r\n\r\nexport type ActorTypes =\r\n  | Name\r\n  | ActorType\r\n  | Alignment\r\n  | Biography\r\n  | Size\r\n  | ConditionType\r\n  | DamageType[]\r\n  | Group\r\n  | Languages\r\n  | Rating\r\n  | Senses\r\n  | Abilities\r\n  | Skill[]\r\n  | ArmorClass\r\n  | Feature[]\r\n  | Rating\r\n  | Speed\r\n  | Health\r\n  | ImportItems\r\n  | ImportSpells\r\n  | ImportSpellcasting;\r\n\r\nexport interface ImportActor {\r\n  name: Name;\r\n  size: Size;\r\n  type: ActorType;\r\n  alignment: Alignment;\r\n  senses: Senses;\r\n  languages: Languages;\r\n  biography: Biography;\r\n  damageImmunities: DamageTypes;\r\n  damageResistances: DamageTypes;\r\n  conditionImmunities: ConditionTypes;\r\n  damageVulnerabilities: DamageTypes;\r\n  health: Health;\r\n  rating: Rating;\r\n  armorClass: ArmorClass;\r\n  abilities: Abilities;\r\n  speed: Speed;\r\n  skills: Skill[];\r\n  items: ImportItems;\r\n  spells: ImportSpells;\r\n  spellcasting: ImportSpellcasting;\r\n}\r\n\r\nexport interface ImportActorParser {\r\n  parseName: ((lines: string[]) => Name)[];\r\n  parseSize: ((lines: string[]) => Size)[];\r\n  parseType: ((lines: string[]) => ActorType)[];\r\n  parseAlignment: ((lines: string[]) => Alignment)[];\r\n  parseSenses: ((lines: string[]) => Senses)[];\r\n  parseLanguages: ((lines: string[]) => Languages)[];\r\n  parseBiography: ((lines: string[]) => Biography)[];\r\n  parseDamageImmunities: ((lines: string[]) => DamageTypes)[];\r\n  parseDamageResistances: ((lines: string[]) => DamageTypes)[];\r\n  parseConditionImmunities: ((lines: string[]) => ConditionTypes)[];\r\n  parseDamageVulnerabilities: ((lines: string[]) => DamageTypes)[];\r\n  parseHealth: ((lines: string[]) => Health)[];\r\n  parseRating: ((lines: string[]) => Rating)[];\r\n  parseArmorClass: ((lines: string[]) => ArmorClass)[];\r\n  parseAbilities: ((lines: string[]) => Abilities)[];\r\n  parseSpeed: ((lines: string[]) => Speed)[];\r\n  parseSkills: ((lines: string[]) => Skill[])[];\r\n  parseItems: ((lines: string[], abilities: Abilities) => ImportItems)[];\r\n  parseSpells: ((lines: string[]) => ImportSpells)[];\r\n  parseSpellcasting: ((lines: string[]) => ImportSpellcasting)[];\r\n}\r\n\r\nexport interface Formula {\r\n  value: number;\r\n  str?: string;\r\n  min?: number;\r\n  max?: number;\r\n  mod?: number;\r\n  afterRegex?: string;\r\n  beforeRegex?: string;\r\n  afterFormula?: string;\r\n  beforeFormula?: string;\r\n}\r\n","import { parseItem } from '../../item/parsers';\r\nimport { getMaxAbility } from '../convert';\r\nimport {\r\n  Abilities,\r\n  Ability,\r\n  ActorType,\r\n  Alignment,\r\n  ArmorClass,\r\n  Biography,\r\n  ConditionTypes,\r\n  DamageType,\r\n  DamageTypes,\r\n  Feature,\r\n  Features,\r\n  Group,\r\n  Health,\r\n  ImportActorParser,\r\n  ImportItems,\r\n  ImportSpellcasting,\r\n  ImportSpells,\r\n  isAbilities,\r\n  Languages,\r\n  Name,\r\n  Rating,\r\n  SectionLabel,\r\n  Senses,\r\n  Size,\r\n  Skill,\r\n} from '../interfaces';\r\nimport { parseGenericFormula } from './generic';\r\n\r\nconst FEATURE_SECTIONS = [\r\n  'ACTIONS',\r\n  'FEATURES',\r\n  'REACTIONS',\r\n  'LEGENDARY ACTIONS',\r\n  'BONUS ACTIONS',\r\n  'VILLAIN ACTIONS',\r\n  'UTILITY SPELLS',\r\n];\r\n\r\nexport const ParseActorWTC: ImportActorParser = {\r\n  parseName: [parseNameWTC],\r\n  parseRating: [parseRatingWTC, parseRatingMCDM],\r\n  parseType: [parseTypeWTC],\r\n  parseAlignment: [parseAlignmentWTC],\r\n  parseBiography: [parseBiographyWTC],\r\n  parseLanguages: [parseLanguagesWTC],\r\n  parseSize: [parseSizeWTC],\r\n  parseHealth: [parseHealthWTC],\r\n  parseSenses: [parseSensesWTC],\r\n  parseArmorClass: [parseACWTC],\r\n  parseDamageImmunities: [parseDamageImmunitiesWTC],\r\n  parseDamageResistances: [parseDamageResistancesWTC],\r\n  parseConditionImmunities: [parseConditionImmunitiesWTC],\r\n  parseDamageVulnerabilities: [parseDamageVulnerabilitiesWTC],\r\n  parseAbilities: [\r\n    parseAbilitiesWTC,\r\n    parseMultiLineAbilitiesWTC,\r\n    parseVerticalKeyValueAbilitiesWTC,\r\n    parseVerticalNameValModFormatWTC,\r\n    parseGPTBlockAbilities,\r\n    parseInlineAbilityValueModWTC,\r\n  ],\r\n  parseSpeed: [parseSpeedWTC],\r\n  parseSkills: [parseSkillsWTC],\r\n  parseItems: [parseItemsWTC],\r\n  parseSpells: [parseSpellsWTC],\r\n  parseSpellcasting: [parseSpellcastingWTC],\r\n};\r\n\r\nconst ABILITY_MAP: Record<string, string> = {\r\n  str: 'strength',\r\n  dex: 'dexterity',\r\n  con: 'constitution',\r\n  int: 'intelligence',\r\n  wis: 'wisdom',\r\n  cha: 'charisma',\r\n};\r\n\r\nconst SHORT_ABILITY_MAP: Record<string, string> = {\r\n  strength: 'str',\r\n  dexterity: 'dex',\r\n  constitution: 'con',\r\n  intelligence: 'int',\r\n  wisdom: 'wis',\r\n  charisma: 'cha',\r\n};\r\n\r\nconst pascal = (s: string) =>\r\n  s.replace(/(\\w)(\\w*)/g, function (_, g1, g2) {\r\n    return g1.toUpperCase() + g2.toLowerCase();\r\n  });\r\n\r\nexport function parseHealthWTC(lines: string[]) {\r\n  let healthLine = lines.find((line) => line.toUpperCase().includes('HIT POINTS'));\r\n  if (!healthLine) throw new Error('Could not find health line');\r\n  healthLine = pascal(healthLine);\r\n  let parsed = parseGenericFormula(healthLine.toLowerCase(), /hit points (.*)/);\r\n  // above case is for pattern matching Hit Points 8 (1d6 + 2)\r\n  // Match pattern Hit Points: Hit Points: 8 (1d6 + 2)\r\n  if (!parsed?.value) parsed = parseGenericFormula(healthLine.toLowerCase(), /hit points: (.*)/);\r\n  const { min, max, str, value } = parsed;\r\n  const health = {\r\n    min,\r\n    max,\r\n    value,\r\n    formula: str,\r\n  };\r\n  if (!(health as Health).value) {\r\n    throw new Error('Could not parse health from line: ' + healthLine);\r\n  }\r\n  return health;\r\n}\r\n\r\nexport function parseNameWTC(lines: string[]): Name {\r\n  let name = lines[0].trim();\r\n  name = name.toLowerCase().split(' cr ')[0];\r\n  name = name.trim().split(' ').map(pascal).join(' ');\r\n  return name;\r\n}\r\n\r\nexport function parseACWTC(lines: string[]): ArmorClass {\r\n  let acString = lines.find((line) => line.toUpperCase().includes('ARMOR CLASS'));\r\n  if (!acString) {\r\n    acString = lines.find((line) => line.trim().toUpperCase().startsWith('AC'));\r\n    if (!acString) throw new Error('Could not find AC line');\r\n  }\r\n  acString = pascal(acString);\r\n  if (!acString || typeof acString !== 'string') {\r\n    throw new Error('Could not find AC line');\r\n  }\r\n  // acString: Armor Class 17 (natural armor)\r\n  // get string from between parentheses\r\n  let ac = 'Natural Armor';\r\n  if (acString.includes('(')) {\r\n    const acArray = acString.match(/\\(([^)]+)\\)/);\r\n    if (!acArray || acArray.length < 1) {\r\n      throw new Error(`Could not parse armor type from string: ${acString} | array was: ${acArray}`);\r\n    }\r\n    // pull formula from match\r\n    ac = acArray.length > 1 ? acArray[1] : 'Natural Armor';\r\n  }\r\n  // find number in string\r\n  const acNumber = acString.match(/\\d+/);\r\n  if (!acNumber || acNumber.length < 1) {\r\n    throw new Error(`Could not parse AC from string: ${acString} | number was: ${acNumber}`);\r\n  }\r\n  return {\r\n    value: Number(acNumber[0]),\r\n    type: ac.toLowerCase(),\r\n  };\r\n}\r\n\r\nfunction parseAbilityScore(score: number, mod?: string): Ability {\r\n  let modNumber = 0;\r\n  if (!mod) return { value: score, mod: modNumber, savingThrow: 0 };\r\n  if (mod.includes('-') || mod.includes('–')) {\r\n    // extract number from the string\r\n    const modNumberString = mod.match(/\\d+/) || '0';\r\n    modNumber = -1 * Number(modNumberString[0]);\r\n  } else {\r\n    modNumber = Number(mod);\r\n  }\r\n  return {\r\n    value: score,\r\n    mod: modNumber,\r\n    savingThrow: 0,\r\n  };\r\n}\r\n\r\nfunction isAbilityLine(line: string) {\r\n  let isAbilityLine = true;\r\n  isAbilityLine = isAbilityLine && line.toUpperCase().includes('STR');\r\n  isAbilityLine = isAbilityLine && line.toUpperCase().includes('DEX');\r\n  isAbilityLine = isAbilityLine && line.toUpperCase().includes('CON');\r\n  isAbilityLine = isAbilityLine && line.toUpperCase().includes('INT');\r\n  isAbilityLine = isAbilityLine && line.toUpperCase().includes('WIS');\r\n  isAbilityLine = isAbilityLine && line.toUpperCase().includes('CHA');\r\n  return isAbilityLine;\r\n}\r\n\r\nfunction containsAbility(line: string) {\r\n  if (!line) return false;\r\n  const abilities = ['STR', 'DEX', 'CON', 'INT', 'WIS', 'CHA'];\r\n  return (\r\n    abilities.findIndex((ability) => {\r\n      return line.trim().toUpperCase() === ability;\r\n    }) !== -1\r\n  );\r\n}\r\n\r\nfunction extractAbilityValues(valueLine: string): { abilities: number[]; modifiers: string[] } {\r\n  let abilityValuesWithSpaces = valueLine.split(' ');\r\n  // if there is weird formatting such as no space between the value and parens\r\n  // like 7(-2), split using parens as well\r\n  if (abilityValuesWithSpaces.length < 12) {\r\n    abilityValuesWithSpaces = abilityValuesWithSpaces.flatMap((value) => value.split(/(?=\\()/));\r\n  }\r\n  const abilityValues = abilityValuesWithSpaces.filter((item) => item.length > 0);\r\n  const abilities: number[] = [];\r\n  const modifiers: string[] = Array(6).fill('0');\r\n  abilityValues.forEach((value) => {\r\n    if (value.includes('(')) {\r\n      modifiers[abilities.length - 1] = value.replace('(', '').replace(')', '').trim();\r\n    } else {\r\n      abilities.push(parseInt(value));\r\n    }\r\n  });\r\n  return { abilities, modifiers };\r\n}\r\n\r\nfunction zipStats(abilityKeys: string[], abilities: number[], modifiers: string[]): Abilities {\r\n  return abilityKeys.reduce(\r\n    (obj, k, i) => ({ ...obj, [k.toLowerCase()]: parseAbilityScore(abilities[i], modifiers[i]) }),\r\n    {},\r\n  ) as Abilities;\r\n}\r\n\r\nexport function parseAbilitiesWTC(inputList: string[]): Abilities {\r\n  const abilityLine = inputList.find(isAbilityLine);\r\n  if (!abilityLine) {\r\n    throw new Error('Could not find ability line');\r\n  }\r\n  const abilityIndex = inputList.indexOf(abilityLine);\r\n  const singleLine = /str/i.test(abilityLine);\r\n  if (!singleLine) {\r\n    throw new Error('Could not parse abilities from parseAbilitiesWTC');\r\n  }\r\n\r\n  // match 3 to 6 letters\r\n  const abilityKeys = abilityLine.match(/\\w{3,7}/g);\r\n  if (!abilityKeys || abilityKeys.length < 6) {\r\n    throw new Error('Could not find ability keys');\r\n  }\r\n  const valueLine = inputList[abilityIndex + 1];\r\n  const { abilities, modifiers } = extractAbilityValues(valueLine);\r\n  const finalAbilities = zipStats(abilityKeys, abilities, modifiers);\r\n  if (!isAbilities(finalAbilities)) {\r\n    throw new Error('Could not parse abilities from parseAbilitiesWTC');\r\n  }\r\n  return finalAbilities;\r\n}\r\n\r\nfunction indexOfAbility(lines: string[], ability: string): number {\r\n  let firstIndex = 0;\r\n  lines.forEach((line, index) => {\r\n    if (line.trim().toLowerCase() === ability.trim().toLowerCase()) firstIndex = index;\r\n  });\r\n  return firstIndex;\r\n}\r\n\r\nfunction parseMod(line: string) {\r\n  const components = line.split(' ');\r\n  return {\r\n    value: Number(components[0]),\r\n    mod: Number(components[1].replace('(', '').replace(')', '')),\r\n    savingThrow: 0,\r\n  };\r\n}\r\n\r\nexport function findAbilityBounds(input: string[]): { lastLine: number; firstLine: number } {\r\n  const lines = new Array(...input);\r\n  const firstLine = lines.findIndex((line) => {\r\n    return line.trim().toLowerCase() === 'str';\r\n  });\r\n  if (firstLine === undefined) {\r\n    throw new Error('Could not find first line');\r\n  }\r\n  const remainingLines = lines.slice(firstLine, lines.length);\r\n  let lastLine =\r\n    remainingLines.findIndex((line) => {\r\n      const trimArray = line.trim().split(' ');\r\n      return trimArray.length > 3;\r\n    }) + firstLine;\r\n  if (lastLine === -1) {\r\n    lastLine = lines.length;\r\n  }\r\n  return { firstLine, lastLine };\r\n}\r\n\r\nexport function parseMultiLineAbilitiesWTC(lines: string[]): Abilities {\r\n  if (lines[indexOfAbility(lines, 'STR') + 1].trim().toUpperCase() === 'DEX') {\r\n    throw new Error('Invalid format for multi line stat parsing.');\r\n  }\r\n  const parsed = {\r\n    str: parseMod(lines[indexOfAbility(lines, 'STR') + 1]),\r\n    dex: parseMod(lines[indexOfAbility(lines, 'DEX') + 1]),\r\n    con: parseMod(lines[indexOfAbility(lines, 'CON') + 1]),\r\n    int: parseMod(lines[indexOfAbility(lines, 'INT') + 1]),\r\n    wis: parseMod(lines[indexOfAbility(lines, 'WIS') + 1]),\r\n    cha: parseMod(lines[indexOfAbility(lines, 'CHA') + 1]),\r\n  };\r\n  if (!isAbilities(parsed)) {\r\n    throw new Error('Could not parse abilities from parseMultilineAbilitiesWTC');\r\n  }\r\n  return parsed;\r\n}\r\n\r\nexport function getVerticalKeyValueAbilities(input: string[]) {\r\n  const { firstLine, lastLine } = findAbilityBounds(input);\r\n  const lines = input.slice(firstLine, lastLine);\r\n  const keyEndIndex = lines.findIndex((line) => {\r\n    return !containsAbility(line);\r\n  });\r\n  const keys = lines.slice(0, keyEndIndex).map((line) => line.trim().toLowerCase());\r\n  const values = lines.slice(keyEndIndex, keyEndIndex + 6).map((line) => line.trim().toLowerCase());\r\n  return { keys, values };\r\n}\r\n\r\nexport function parseVerticalKeyValueAbilitiesWTC(input: string[]): Abilities {\r\n  const { keys, values } = getVerticalKeyValueAbilities(input);\r\n  const { abilities, modifiers } = extractAbilityValues(values.join(' '));\r\n  const zipped = zipStats(keys, abilities, modifiers);\r\n  if (!isAbilities(zipped)) {\r\n    throw new Error('Could not parse abilities with parseVerticalKeyValueAbilitiesWTC');\r\n  }\r\n  return zipped;\r\n}\r\n\r\nconst ABILITIES_WTC = ['str', 'dex', 'con', 'int', 'wis', 'cha'];\r\nconst isAbilityKey = (key: string) => ABILITIES_WTC.includes(key.toLowerCase().trim());\r\n\r\n// parse ability score of following format\r\n// STR 18 (+4) DEX 13 (+1) CON 16 (+3) INT 10 (+0) WIS 10 (+0) CHA 10 (+0)\r\nexport function parseInlineAbilityValueModWTC(input: string[]): Abilities {\r\n  const abilityLine = input.find((line) => line.indexOf('STR') !== -1 && line.indexOf('DEX') !== -1);\r\n  if (!abilityLine) {\r\n    throw new Error('Could not find ability line');\r\n  }\r\n\r\n  const line = abilityLine.toUpperCase();\r\n  if (line.indexOf('STR') === -1 || line.indexOf('DEX') === -1) {\r\n    throw new Error('Could not parse abilities with parseInlineAbilityValueModWTC');\r\n  }\r\n\r\n  const abilities = ABILITIES_WTC;\r\n  const valuesAndMods = line.split(' ').filter((value) => !isAbilityKey(value));\r\n  // use the existing parser, just format it correctly\r\n  const abilityArray = [abilities.join(' ').toUpperCase(), valuesAndMods.join(' ')];\r\n  const builtAbilities = parseAbilitiesWTC(abilityArray);\r\n\r\n  if (!isAbilities(builtAbilities)) {\r\n    throw new Error('Could not parse abilities with parseInlineAbilityValueModWTC');\r\n  }\r\n\r\n  return builtAbilities;\r\n}\r\n\r\nexport function parseVerticalNameValModFormatWTC(input: string[]): Abilities {\r\n  const { firstLine, lastLine } = findAbilityBounds(input);\r\n  const lines = input.slice(firstLine, lastLine);\r\n  const removedAbilities = lines.filter((line) => !containsAbility(line));\r\n  const { abilities, modifiers } = extractAbilityValues(removedAbilities.join(' '));\r\n  const parsed = zipStats(ABILITIES_WTC, abilities, modifiers);\r\n  if (!isAbilities(parsed)) {\r\n    throw new Error('Could not parse abilities with parseVerticalNameValModFormatWTC');\r\n  }\r\n  return parsed;\r\n}\r\n\r\nconst findAbilityValueBounds = (input: string[]): number => {\r\n  // find the firstLine lastLine bounds for an ability string\r\n  // the abilities are all on one line\r\n  // like the below example:\r\n  // STR 8 (-1) DEX 12 (+1) CON 12 (+1) INT 14 (+2) WIS 10 (+0) CHA 14 (+2)\r\n  const indexWithAbility = input.findIndex((line) => line.toLowerCase().includes('str'));\r\n  const lineWithAbility = input[indexWithAbility];\r\n  if (!lineWithAbility) {\r\n    throw new Error('Could not find line with ability');\r\n  }\r\n\r\n  const lineContainsTwoAbilities = (line: string) => {\r\n    return line.toLowerCase().includes('str') && line.toLowerCase().includes('dex');\r\n  };\r\n\r\n  if (!lineContainsTwoAbilities(lineWithAbility)) {\r\n    throw new Error('Line does not contain two abilities');\r\n  }\r\n  return indexWithAbility;\r\n};\r\n\r\nexport function parseGPTBlockAbilities(input: string[]): Abilities {\r\n  const indexOfAbility = findAbilityValueBounds(input);\r\n  const abilityLine = input[indexOfAbility];\r\n  // abilityLine:\r\n  // STR 8 (-1) DEX 12 (+1) CON 12 (+1) INT 14 (+2) WIS 10 (+0) CHA 14 (+2)\r\n  const abilities = abilityLine.split(' ').reduce((acc: Record<string, unknown>, cur: string, index: number) => {\r\n    if (index % 3 === 0) {\r\n      const ability = cur.toLowerCase().trim();\r\n      const value = Number(abilityLine.split(' ')[index + 1]);\r\n      const mod = Number(abilityLine.split(' ')[index + 2].replace('(', '').replace(')', ''));\r\n      acc[`${ability}`] = { value, mod, savingThrow: 0 };\r\n    }\r\n    return acc;\r\n  }, {});\r\n\r\n  if (!isAbilities(abilities)) {\r\n    throw new Error('Could not parse abilities with parseGPTBlockAbilities');\r\n  }\r\n  return abilities;\r\n}\r\n\r\nexport function parseSpeedWTC(lines: string[]) {\r\n  const speedLine = lines.find((line) => line.toUpperCase().includes('SPEED'));\r\n  if (!speedLine) {\r\n    throw new Error('Could not find speed line');\r\n  }\r\n  const speed = speedLine.match(/\\d+/);\r\n  if (!speed || speed.length < 1) {\r\n    throw new Error('Could not find speed');\r\n  }\r\n  return Number(speed[0]);\r\n}\r\n\r\nexport function parseSkillsWTC(lines: string[]): Skill[] {\r\n  let skillLine = lines.find((line) => line.toUpperCase().includes('SKILL'));\r\n  if (!skillLine) {\r\n    throw new Error('Could not find skill line');\r\n  }\r\n  skillLine = skillLine.replace(/skills/i, '');\r\n  const skillKeys = skillLine.match(/\\w{3,13}/g);\r\n  if (!skillKeys || skillKeys.length < 1) {\r\n    throw new Error('Could not find skill keys');\r\n  }\r\n  const skillValues = skillLine.match(/\\d+/g);\r\n  if (!skillValues || skillValues.length < 1) {\r\n    throw new Error('Could not find skill values');\r\n  }\r\n\r\n  const skills = skillKeys.map((value, index) => {\r\n    return {\r\n      name: value.toLowerCase(),\r\n      bonus: Number(skillValues[index]),\r\n    };\r\n  });\r\n  return skills;\r\n}\r\n\r\nexport function addSavingThrows(lines: string[], abilities: Abilities): Abilities {\r\n  const savingThrowsLine = lines.find((line) => line.toUpperCase().includes('SAVING THROWS'));\r\n  if (!savingThrowsLine) {\r\n    return abilities;\r\n  }\r\n  const savingThrowsArray = savingThrowsLine.replace('Saving Throws', '').trim().split(' ');\r\n  const abilityList = ['str', 'dex', 'con', 'int', 'wis', 'cha'];\r\n  savingThrowsArray.forEach((check, index) => {\r\n    if (abilityList.includes(check.toLowerCase())) {\r\n      const strNumber = savingThrowsArray[index + 1].replace('+', '');\r\n      const parsedNumber = parseInt(strNumber);\r\n      if (check.toLowerCase() === 'str') {\r\n        abilities.str.savingThrow = parsedNumber - abilities.str.mod;\r\n      } else if (check.toLowerCase() === 'dex') {\r\n        abilities.dex.savingThrow = parsedNumber - abilities.dex.mod;\r\n      } else if (check.toLowerCase() === 'con') {\r\n        abilities.con.savingThrow = parsedNumber - abilities.con.mod;\r\n      } else if (check.toLowerCase() === 'int') {\r\n        abilities.int.savingThrow = parsedNumber - abilities.int.mod;\r\n      } else if (check.toLowerCase() === 'wis') {\r\n        abilities.wis.savingThrow = parsedNumber - abilities.wis.mod;\r\n      } else if (check.toLowerCase() === 'cha') {\r\n        abilities.cha.savingThrow = parsedNumber - abilities.cha.mod;\r\n      }\r\n    }\r\n  });\r\n  return abilities;\r\n}\r\n\r\nexport function parseStandardCSV(lines: string[], name: string): Group {\r\n  let standardLine = lines.find((line) => line.toUpperCase().includes(name.toUpperCase()));\r\n  if (!standardLine) {\r\n    throw new Error(`${name} not found`);\r\n  }\r\n  const rePattern = new RegExp(`${name}`, 'gi');\r\n  standardLine = standardLine.replace(rePattern, '');\r\n  return {\r\n    name,\r\n    collection: standardLine.split(',').map((value) => value.trim()),\r\n  };\r\n}\r\n\r\nconst isMCDMVillainAction = (name: string) => {\r\n  return name.includes('Action 1:') || name.includes('Action 2:') || name.includes('Action 3:');\r\n};\r\n\r\nconst gptClean = (line: string): string => {\r\n  if (line.trim().startsWith('- ')) {\r\n    return line.trim().replace('- ', '');\r\n  }\r\n  return line.trim();\r\n};\r\n\r\nfunction getFeatureWithEnding(input: string, ending: string) {\r\n  const line = gptClean(input);\r\n  const wordsRequiredForName = 4;\r\n  // match 1 or 2 words in a row that start with a capital letters and ending\r\n  // in a period\r\n  const regString = `\\\\b[A-Z]{1}[a-z]{1,}\\\\b\\\\${ending}`;\r\n  const re = new RegExp(regString, 'g');\r\n  // Remove parens and content inside, and leading space\r\n  // Poison Recharge (5-6). Some text -> Poison Recharge. Some text\r\n  const parenRegex = / \\(([^)]+)\\)/;\r\n\r\n  const lineWithoutParens = line.replace(parenRegex, '');\r\n\r\n  const reduceOutWords = (acc: string, word: string) => {\r\n    acc = acc.replace(` ${word} `, ' ');\r\n    acc = acc.replace(`${word}`, '');\r\n    return acc;\r\n  };\r\n  // Remove any characters that don't factor into our name regex\r\n  // don't pull out the denominator we are attempting to split on\r\n  let ignoredSubstrings = ['of', 'the', 'and', ',', '!', '.'];\r\n  ignoredSubstrings = ignoredSubstrings.filter((substr) => substr !== ending);\r\n  const cleanedForName = ignoredSubstrings.reduce(reduceOutWords, lineWithoutParens).replace(')', '');\r\n\r\n  const matches = cleanedForName.match(re);\r\n  if (matches) {\r\n    const name = line.split(ending)[0];\r\n    // If our regex didn't grab a match at the beginning of the line, return\r\n    const nameWithoutConjunctions = ignoredSubstrings.reduce(reduceOutWords, name);\r\n    if (nameWithoutConjunctions.replace(parenRegex, '').trim().split(' ').length > wordsRequiredForName) {\r\n      return;\r\n    }\r\n\r\n    if (isMCDMVillainAction(name)) return;\r\n    return name;\r\n  }\r\n\r\n  return undefined;\r\n}\r\n\r\nconst isGPTName = (line: string): boolean => {\r\n  return line.trim().startsWith('-');\r\n};\r\nexport function getFeatureName(line: string): string | undefined {\r\n  if (isGPTName(line)) {\r\n    return getFeatureWithEnding(line, ':');\r\n  }\r\n  return getFeatureWithEnding(line, '.') ?? getFeatureWithEnding(line, '!');\r\n}\r\n\r\ninterface Section {\r\n  name: string;\r\n  description?: string;\r\n  features: Feature[];\r\n}\r\n\r\nconst WTC_TO_FOUNDRY_SECTION_MAP: Record<string, SectionLabel> = {\r\n  ACTIONS: 'action',\r\n  UTILITY: 'action',\r\n  REACTIONS: 'reaction',\r\n  'BONUS ACTIONS': 'bonus',\r\n  'LEGENDARY ACTIONS': 'legendary',\r\n  'VILLAIN ACTIONS': 'legendary',\r\n};\r\n\r\nfunction fromFoundrySection(section?: SectionLabel): string | undefined {\r\n  if (!section) {\r\n    return;\r\n  }\r\n  let foundKey: string | undefined;\r\n  Object.entries(WTC_TO_FOUNDRY_SECTION_MAP).forEach(([key, value]) => {\r\n    if (value === section && foundKey === undefined) {\r\n      foundKey = key;\r\n    }\r\n  });\r\n  return foundKey;\r\n}\r\n\r\nfunction toSection(line: string): SectionLabel | undefined {\r\n  const name = line.toUpperCase();\r\n  if (name in WTC_TO_FOUNDRY_SECTION_MAP) {\r\n    return WTC_TO_FOUNDRY_SECTION_MAP[name];\r\n  }\r\n\r\n  return;\r\n}\r\n\r\nfunction reduceToFeatures(acc: string[], curr: string, sections: string[]): string[] {\r\n  const line = curr.trim();\r\n\r\n  if (line.trim() === '') return acc;\r\n\r\n  if (sections.includes(line.toUpperCase())) {\r\n    acc.push(line.toUpperCase());\r\n    return acc;\r\n  }\r\n\r\n  const names = getFeatureName(line);\r\n  if (names || acc.length === 0) {\r\n    acc.push(line.trim());\r\n  } else {\r\n    // the next line after 'legendary resistance' is a description of the\r\n    // resistance, so the section header gets lost\r\n    // need to check if the previous line was a section header, and if so\r\n    // create a new entry including the previous header\r\n    const lastEntry = acc[acc.length - 1];\r\n    if (sections.includes(lastEntry.toUpperCase()) && line) {\r\n      const stitchedFeature = `${pascal(lastEntry)}. ${line.trim()}`;\r\n      acc.push(stitchedFeature);\r\n      return acc;\r\n    }\r\n\r\n    // if the line was a continuation, dont add a space\r\n    const bindWith = acc[acc.length - 1].endsWith('-') ? '' : ' ';\r\n    // if line ended with a - for a continuation, remove it\r\n    if (acc[acc.length - 1].endsWith('-')) {\r\n      acc[acc.length - 1] = acc[acc.length - 1].slice(0, -1);\r\n    }\r\n    acc[acc.length - 1] = acc[acc.length - 1].trim() + bindWith + line.trim();\r\n  }\r\n  acc[acc.length - 1] = acc[acc.length - 1].trim();\r\n  return acc;\r\n}\r\n\r\nfunction featureStringsToFeatures(line: string, sectionName?: SectionLabel) {\r\n  const fetchedName = getFeatureName(line);\r\n  let name = '';\r\n  if (!fetchedName) name = sectionName ?? '';\r\n  else name = fetchedName.trim();\r\n\r\n  let cleanLine = line.replace(name, '').trim();\r\n  if (cleanLine.startsWith('.')) cleanLine = cleanLine.substring(1);\r\n  if (cleanLine.startsWith(' ')) cleanLine = cleanLine.substring(1);\r\n  cleanLine.replace('-\\n', '');\r\n  const feature: Feature = {\r\n    name,\r\n    description: cleanLine,\r\n    section: sectionName,\r\n  };\r\n  return feature;\r\n}\r\n\r\nexport function featureFromSection(sections: Section[], match: string): Section {\r\n  return (\r\n    sections.find(({ name }) => {\r\n      return name.toUpperCase() === match.toUpperCase();\r\n    }) || { features: [], name: 'No matching feature' }\r\n  );\r\n}\r\n\r\nexport function findFirstSectionIndex(lines: string[], term: string): number {\r\n  let firstMatch = 0;\r\n  lines.forEach((line) => {\r\n    if (line.toUpperCase().includes(term.toUpperCase()) && line.split(' ').length < 3) {\r\n      firstMatch = lines.indexOf(line);\r\n    }\r\n  });\r\n  if (firstMatch === 0) {\r\n    return -1;\r\n  }\r\n  return firstMatch + 1;\r\n}\r\n\r\nexport function parseBiographyWTC(lines: string[]): Biography {\r\n  let firstBioIndex = -1;\r\n  lines.forEach((line: string, index: number) => {\r\n    if (firstBioIndex === -1 && line.toUpperCase().includes('MEDIUM' || 'LARGE' || 'TINY')) {\r\n      firstBioIndex = index;\r\n    }\r\n  });\r\n  if (firstBioIndex === -1) {\r\n    throw new Error('Could not find a valid biography');\r\n  }\r\n  return lines[firstBioIndex].trim();\r\n}\r\n\r\nexport function parseRatingMCDM(lines: string[]): Rating {\r\n  const challengeLine = lines.find((line) => line.includes('CR'));\r\n  if (!challengeLine) {\r\n    throw new Error('Could not find a valid challenge rating');\r\n  }\r\n  const cr = challengeLine.split(' ').find((number) => {\r\n    try {\r\n      return parseInt(number) >= 0;\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n  });\r\n  if (!cr) {\r\n    throw new Error('Could not find a valid challenge rating');\r\n  }\r\n\r\n  const xpLine = lines.find((line) => line.includes('XP'));\r\n  if (!xpLine) {\r\n    throw new Error('Could not find a valid experience rating');\r\n  }\r\n  const xp = xpLine.split(' ').find((number) => {\r\n    try {\r\n      return parseInt(number) >= 0;\r\n    } catch (e) {\r\n      return false;\r\n    }\r\n  });\r\n  if (!xp) {\r\n    throw new Error('Could not find a valid experience rating');\r\n  }\r\n\r\n  return {\r\n    cr: parseInt(cr),\r\n    xp: parseInt(xp),\r\n  };\r\n}\r\n\r\nexport function parseRatingWTC(lines: string[]): Rating {\r\n  const challengeLine = lines.find((line) => line.includes('Challenge'));\r\n  if (!challengeLine) throw new Error('could not parse challenge');\r\n  // challengeLine : Challenge 1 (200 XP)\r\n  // get the first number in the line\r\n  const ratingString = challengeLine.split(' ')[1];\r\n  let cr = 0;\r\n  if (ratingString.includes('/')) {\r\n    const [num, denom] = ratingString.split('/');\r\n    cr = Number(num) / Number(denom);\r\n  } else {\r\n    if (Number(ratingString)) cr = Number(ratingString);\r\n  }\r\n  // get the number in the parentheses\r\n  const xp = Number(challengeLine.split('(')[1].split(')')[0].replace('xp', '').replace('XP', '').replace(',', ''));\r\n  return {\r\n    cr,\r\n    xp,\r\n  };\r\n}\r\n\r\nfunction getListRelated(to: string, inStrings: string[]) {\r\n  const conditionImmunityLineIndex = inStrings.findIndex((line) => line.toLowerCase().includes(to));\r\n  if (conditionImmunityLineIndex === -1) return;\r\n  let conditionImmunityLine = inStrings[conditionImmunityLineIndex];\r\n  let remaining = inStrings;\r\n  if (inStrings.length > conditionImmunityLineIndex) {\r\n    remaining = inStrings.slice(conditionImmunityLineIndex + 1);\r\n  }\r\n  let iter = 0;\r\n  while (containsMoreItems(remaining[iter])) {\r\n    conditionImmunityLine = conditionImmunityLine + ' ' + remaining[iter];\r\n    iter++;\r\n  }\r\n  return conditionImmunityLine;\r\n}\r\n\r\n/*\r\n * List name, i.e. 'damage immunities'\r\n */\r\nfunction parseNamedList(lines: string[], listName: string): DamageTypes | ConditionTypes {\r\n  const nameWithWordsCapitalized = listName\r\n    .split(' ')\r\n    .map((word) => word.charAt(0).toUpperCase() + word.slice(1))\r\n    .join(' ');\r\n  const listDataLine = getListRelated(listName, lines);\r\n  if (!listDataLine) throw new Error(`could not parse ${listName}`);\r\n  return listDataLine\r\n    .replace(nameWithWordsCapitalized, '')\r\n    .replace('and', '')\r\n    .trim()\r\n    .split(',')\r\n    .map((value) => value.trim())\r\n    .filter((line) => line !== '') as DamageType[];\r\n}\r\n\r\nexport function parseDamageImmunitiesWTC(lines: string[]) {\r\n  return parseNamedList(lines, 'damage immunities') as DamageTypes;\r\n}\r\n\r\nexport function parseDamageResistancesWTC(lines: string[]) {\r\n  return parseNamedList(lines, 'damage resistances') as DamageTypes;\r\n}\r\n\r\nfunction containsMoreItems(line: string) {\r\n  if (!line) return false;\r\n  return line.split(',').length > 1 && line.split(',')[0].trim().split(' ').length === 1;\r\n}\r\n\r\nexport function parseConditionImmunitiesWTC(lines: string[]) {\r\n  return parseNamedList(lines, 'condition immunities') as ConditionTypes;\r\n}\r\n\r\nexport function parseDamageVulnerabilitiesWTC(lines: string[]) {\r\n  return parseNamedList(lines, 'damage vulnerabilities') as DamageTypes;\r\n}\r\n\r\ninterface FeatureSection {\r\n  feature: string;\r\n  section?: SectionLabel;\r\n}\r\nfunction addSectionReduction(acc: FeatureSection[], feature: string) {\r\n  if (FEATURE_SECTIONS.includes(feature)) {\r\n    // this is a section label, not a feature\r\n    acc.push({ section: toSection(feature), feature: 'EMPTY' });\r\n  }\r\n\r\n  const lastAdded = acc[acc.length - 1];\r\n  // this is an un populated feature\r\n  if (lastAdded && lastAdded.section && lastAdded.feature === 'EMPTY') {\r\n    lastAdded.feature = feature;\r\n    return acc;\r\n  }\r\n\r\n  // Use the last added section for this feature section\r\n  if (lastAdded && lastAdded.section) {\r\n    const { section } = lastAdded;\r\n    acc.push({ section, feature });\r\n    return acc;\r\n  }\r\n\r\n  acc.push({ feature });\r\n  return acc;\r\n}\r\n\r\nconst mcdmClean = (description: string) => {\r\n  if (description.includes('Action 1:') && description.includes('Action 2:')) {\r\n    return description.replace(/Action \\d:/g, (match) => {\r\n      // split match on the number\r\n      const afterColon = match.split(':')[1];\r\n      const trimColon = match.split(':')[0];\r\n      const number = trimColon.split(' ')[1];\r\n      return `<br><b>Action ${number}:</b> ${afterColon}`;\r\n    });\r\n  }\r\n  return description;\r\n};\r\n\r\nconst getMCDMChangingLine = (lines: string[]): string | undefined => {\r\n  return lines.find((line) => line.includes('CHANGING THE'));\r\n};\r\n\r\nconst getFeatureMatching = (lines: string[], pattern: string): Features => {\r\n  const name = pattern.replace(':', '');\r\n  const gptFeatures: Features = [];\r\n  const spellsIndex = lines.findIndex((line) => line.includes(pattern));\r\n  if (spellsIndex === -1) return [];\r\n  const spells = lines[spellsIndex + 1];\r\n  gptFeatures.push({\r\n    name,\r\n    description: spells,\r\n    section: 'action',\r\n  });\r\n\r\n  return gptFeatures;\r\n};\r\n\r\nconst getGPTFeatures = (lines: string[]): Features => {\r\n  return [\r\n    ...getFeatureMatching(lines, 'Spells:'),\r\n    ...getFeatureMatching(lines, 'Equipment:'),\r\n    ...getFeatureMatching(lines, 'Spellcasting:'),\r\n  ];\r\n};\r\n\r\nexport function parseFeaturesWTC(lines: string[]): Features {\r\n  const changingLine = getMCDMChangingLine(lines)?.trim();\r\n  let formattedLines = lines;\r\n\r\n  // add a section for 'changing the monster' if the section exists\r\n  if (changingLine) {\r\n    formattedLines = lines.map((line) => line.replace(changingLine, `${pascal(changingLine)}.`));\r\n  }\r\n\r\n  // Remove the spellcasting section\r\n  const [start, end] = getSpellcastingRange(formattedLines);\r\n  if (start !== -1 && end !== -1) {\r\n    formattedLines = formattedLines.slice(0, start).concat(formattedLines.slice(end));\r\n  }\r\n\r\n  const firstFeatureLine = formattedLines.findIndex((line) => getFeatureName(line) !== undefined);\r\n  if (firstFeatureLine === -1) throw new Error('Could not find a valid feature');\r\n  const featureLines = formattedLines.slice(firstFeatureLine);\r\n  const featureStrings: string[] = featureLines.reduce(\r\n    (acc: string[], curr: string) => reduceToFeatures(acc, curr, FEATURE_SECTIONS),\r\n    [],\r\n  );\r\n\r\n  const withSections = featureStrings.reduce(addSectionReduction, []);\r\n  let compiledFeatures = withSections.map((entry) => featureStringsToFeatures(entry.feature, entry.section));\r\n  compiledFeatures = compiledFeatures.filter((feature) => {\r\n    feature.description = mcdmClean(feature.description);\r\n    return feature;\r\n  });\r\n\r\n  compiledFeatures = compiledFeatures.filter((feature) => feature.description !== ''); // remove empty features\r\n  compiledFeatures = compiledFeatures.filter(\r\n    (feature) => !FEATURE_SECTIONS.includes(feature.description.toUpperCase()),\r\n  );\r\n\r\n  // add section to last part of description in case foundry doesn't keep it\r\n  const interestingSections = ['bonus', 'legendary', 'reaction'];\r\n  compiledFeatures = compiledFeatures.map((feature) => {\r\n    const fromFoundry = fromFoundrySection(feature.section);\r\n    if (feature.section && interestingSections.includes(feature.section) && fromFoundry) {\r\n      feature.description = `${pascal(fromFoundry)}: ${feature.description}`;\r\n    }\r\n    return feature;\r\n  });\r\n\r\n  compiledFeatures = compiledFeatures.filter((feature) => {\r\n    return !FEATURE_SECTIONS.includes(feature.description) || feature.description === feature.name;\r\n  });\r\n\r\n  const gptFeatures = getGPTFeatures(lines);\r\n  return [...compiledFeatures, ...gptFeatures];\r\n}\r\n\r\nexport function parseItemsWTC(lines: string[], abilities: Abilities): ImportItems {\r\n  const features = parseFeaturesWTC(lines);\r\n  return features.map(({ name, description, section }) => {\r\n    return parseItem({ name, description, ability: getMaxAbility(abilities), section });\r\n  });\r\n}\r\n\r\nfunction getSpellcastingRange(lines: string[]): [number, number] {\r\n  // Find the index of the \"Spellcasting.\" line\r\n  const spellcastingIndex = lines.findIndex(\r\n    (line) => line.startsWith('Spellcasting') || line.startsWith('Innate Spellcasting'),\r\n  );\r\n\r\n  if (spellcastingIndex === -1) {\r\n    return [-1, -1];\r\n  }\r\n\r\n  // Find the start and end indexes of the spellcasting block\r\n  const startIndex = spellcastingIndex + 1;\r\n  function isEndIndex(line: string) {\r\n    const startsWithFeature = FEATURE_SECTIONS.some((feature: string) => line.toUpperCase().startsWith(feature));\r\n    return startsWithFeature;\r\n  }\r\n\r\n  // find isEndIndex after the spellcastingIndex, dont look at lines before the spellcastingIndex\r\n  const spliced = [...lines];\r\n  let endIndex = spliced.splice(spellcastingIndex).findIndex(isEndIndex);\r\n  endIndex = endIndex === -1 ? lines.length : endIndex + spellcastingIndex;\r\n\r\n  // If the end index is not found, set it to the end of the lines array\r\n  if (endIndex === -1) {\r\n    endIndex = lines.length;\r\n  }\r\n  return [startIndex, endIndex];\r\n}\r\n\r\nfunction extractSpells(lines: string[]): ImportSpells {\r\n  let spells: ImportSpells = [];\r\n\r\n  const [startIndex, endIndex] = getSpellcastingRange(lines);\r\n\r\n  // If the \"Spellcasting.\" line is not found, return an empty array\r\n  if (startIndex === -1) {\r\n    return spells;\r\n  }\r\n\r\n  // Loop through the lines in the spellcasting block\r\n  for (let i = startIndex; i < endIndex; i++) {\r\n    const line = lines[i].trim();\r\n\r\n    // Ignore blank lines and lines that don't contain a spell name\r\n    if (line === '' || !line.includes(':')) {\r\n      continue;\r\n    }\r\n\r\n    const checkLine = line.toLowerCase();\r\n    const hasSpellInfo =\r\n      checkLine.includes('at will') ||\r\n      checkLine.includes('each day') ||\r\n      checkLine.includes('each time') ||\r\n      checkLine.includes('day each');\r\n\r\n    if (!hasSpellInfo) {\r\n      continue;\r\n    }\r\n\r\n    // Extract the spell name and uses information\r\n    const [usesText, parsedNames] = line.split(':');\r\n    const split = parsedNames.split('and uses');\r\n    const namesString = split[0].trim();\r\n    const matches = usesText\r\n      .replace(/ /g, '')\r\n      .toLowerCase()\r\n      .match(/(\\d+\\/day each|\\d+\\/day|\\batwill\\b)/i);\r\n    if (matches === null) continue;\r\n    const usesMatch = matches[0].replace('atwill', 'at will');\r\n\r\n    if (usesMatch) {\r\n      const names = namesString.split(',').map((name) => name.trim());\r\n\r\n      let atWill = false;\r\n      let per = 'day';\r\n      let value = 1;\r\n\r\n      if (usesMatch.includes('at will')) {\r\n        atWill = true;\r\n      } else {\r\n        const [valueString, perString] = usesMatch.split('/');\r\n        value = parseInt(valueString);\r\n        per = perString;\r\n      }\r\n\r\n      for (const name of names) {\r\n        // remove all parentheses and their contents in the name\r\n        const cleanedName = name.replace(/\\(.*?\\)/g, '').trim();\r\n        spells.push({\r\n          name: pascal(cleanedName),\r\n          type: 'spell',\r\n          uses: {\r\n            per,\r\n            atWill,\r\n            value,\r\n          },\r\n        });\r\n      }\r\n    }\r\n  }\r\n\r\n  spells = spells.filter((spell) => spell.name !== '');\r\n  return spells;\r\n}\r\n\r\nexport function parseSpellsWTC(lines: string[]): ImportSpells {\r\n  return extractSpells(lines);\r\n}\r\n\r\nexport function parseSpellcastingWTC(lines: string[]): ImportSpellcasting | undefined {\r\n  const [startIndex, endIndex] = getSpellcastingRange(lines);\r\n  const oneLine = lines.slice(startIndex, endIndex).join(' ');\r\n  const longNameAbilities = Object.values(ABILITY_MAP);\r\n  // if a longName is case insensitive in the string, use it\r\n  const ability = longNameAbilities.find((longName) => oneLine.toLowerCase().includes(longName.toLowerCase()));\r\n  if (!ability) return;\r\n  // return the short name of the ability\r\n  return SHORT_ABILITY_MAP[ability];\r\n}\r\n\r\nexport function parseSensesWTC(lines: string[]): Senses {\r\n  const sensesLine = lines.find((line) => line.toLowerCase().includes('senses')) || '';\r\n  if (!sensesLine) throw new Error('Could not find senses');\r\n  const rawSenses = sensesLine.replace('Senses', '').replace('and', '').trim().split(',');\r\n  const senses: Senses = { units: 'ft' };\r\n  rawSenses.forEach((sense) => {\r\n    if (sense === '') return;\r\n    let [text, special] = [sense, ''];\r\n    // remove parens and get text inside\r\n    if (sense.includes('(')) {\r\n      [text, special] = sense.split('(');\r\n      senses.special = special.replace(')', '');\r\n    }\r\n    // get number from string of form darkvision 60ft\r\n    // get regex for number in text\r\n    const numberRegex = /\\d+/;\r\n    const matches = text.match(numberRegex);\r\n    let number = 0;\r\n    if (!matches) {\r\n      return;\r\n    } else {\r\n      number = Number(matches[0]);\r\n    }\r\n    if (/darkvision/.test(sense)) {\r\n      senses.darkvision = number;\r\n    } else if (/blindsignt/i.test(sense)) {\r\n      senses.blindsight = number;\r\n    } else if (/tremorsense/i.test(sense)) {\r\n      senses.tremorsense = number;\r\n    } else if (/truesight/i.test(sense)) {\r\n      senses.truesight = number;\r\n    } else if (/passive/i.test(sense)) {\r\n      senses.passivePerception = number;\r\n    }\r\n  });\r\n  senses.units = 'ft';\r\n  return senses;\r\n}\r\n\r\nfunction getDescriptionLine(lines: string[]): string {\r\n  const candidateLines = lines.slice(0, 8);\r\n  const sizes = ['Tiny', 'Small', 'Medium', 'Large', 'Huge', 'Gargantuan'];\r\n  let descriptionLine = '';\r\n  sizes.forEach((size) => {\r\n    const potentialMatch =\r\n      candidateLines.find((line) => {\r\n        return line.toLowerCase().includes(size.toLowerCase());\r\n      }) || '';\r\n    if (potentialMatch !== '') {\r\n      descriptionLine = potentialMatch;\r\n    }\r\n  });\r\n  return descriptionLine;\r\n}\r\n\r\nexport function parseSizeWTC(lines: string[]): Size {\r\n  const candidateLines = lines.slice(0, 8);\r\n  const sizes = ['Tiny', 'Small', 'Medium', 'Large', 'Huge', 'Gargantuan'];\r\n  const size = sizes.find((size) => {\r\n    const sizeInLine =\r\n      candidateLines.findIndex((line) => {\r\n        const includes = line.toLowerCase().includes(size.toLowerCase());\r\n        return includes;\r\n      }) !== -1;\r\n    if (sizeInLine) {\r\n    }\r\n    return sizeInLine;\r\n  });\r\n  if (!size) throw new Error('Could not parse size');\r\n  return size as Size;\r\n}\r\n\r\nexport function parseTypeWTC(lines: string[]): ActorType {\r\n  const descriptionLine = getDescriptionLine(lines);\r\n  // type is in string before parens and before comma\r\n  if (descriptionLine.includes('(')) {\r\n    const type = descriptionLine.split('(')[0].trim().split(' ').pop();\r\n    if (!type) throw new Error(`Could not parse type from ${descriptionLine}`);\r\n    return type as ActorType;\r\n  }\r\n  const type = descriptionLine.split(',')[0].trim().split(' ').pop();\r\n  if (!type) throw new Error(`Could not parse type from ${descriptionLine}`);\r\n  return type;\r\n}\r\n\r\nfunction capitalizeBeginings(str: string): string {\r\n  return str.replace(/\\w\\S*/g, function (txt) {\r\n    return txt.charAt(0).toUpperCase() + txt.substring(1).toLowerCase();\r\n  });\r\n}\r\n\r\nexport function parseAlignmentWTC(lines: string[]): Alignment {\r\n  const descriptionLine = getDescriptionLine(lines);\r\n  return capitalizeBeginings(descriptionLine.split(',')[1].trim().toLowerCase());\r\n}\r\n\r\nexport function parseLanguagesWTC(lines: string[]): Languages {\r\n  const languageLine = lines.find((line) => line.toLowerCase().includes('languages')) || '';\r\n  if (!languageLine) throw new Error(`Could not find language line in ${lines}`);\r\n  const languages = languageLine.replace('Languages', '').replace('and', '').trim().split(',');\r\n  return languages.map((language) => language.trim().toLowerCase());\r\n}\r\n","import { ParseActorWTC } from './wtcTextBlock';\r\n\r\nexport const ACTOR_PARSERS = [ParseActorWTC];\r\n","import {\r\n  Abilities,\r\n  ActorType,\r\n  ActorTypes,\r\n  Alignment,\r\n  ArmorClass,\r\n  Biography,\r\n  ConditionTypes,\r\n  DamageTypes,\r\n  Health,\r\n  ImportActor,\r\n  ImportActorParser,\r\n  ImportItems,\r\n  ImportSpellcasting,\r\n  ImportSpells,\r\n  Languages,\r\n  Rating,\r\n  Senses,\r\n  Size,\r\n  Skill,\r\n  Speed,\r\n} from '../interfaces';\r\nimport { addSavingThrows } from './wtcTextBlock';\r\n\r\nfunction damageTypeGuard(damageTypes: unknown): DamageTypes {\r\n  if (Array.isArray(damageTypes)) {\r\n    return damageTypes as DamageTypes;\r\n  }\r\n  throw new Error('Damage types must be an array');\r\n}\r\n\r\nexport function trySingleActorParse(parser: ImportActorParser, lines: string[]): ImportActor {\r\n  const abilities = tryParser<Abilities>(parser.parseAbilities, lines, (abilities) => {\r\n    if ((abilities as Abilities).str) {\r\n      const abilitiesWithSaves = addSavingThrows(lines, abilities as Abilities);\r\n      return abilitiesWithSaves as Abilities;\r\n    }\r\n    throw new Error('Abilities must be of type Abilities');\r\n  });\r\n  return {\r\n    name: tryParser<string>(parser.parseName, lines, (value) => {\r\n      if (typeof value === 'string') {\r\n        return value;\r\n      } else throw new Error('Name must be string');\r\n    }),\r\n    rating: tryParser<Rating>(\r\n      parser.parseRating,\r\n      lines,\r\n      (value) => {\r\n        if ((value as Rating).xp) {\r\n          return value as Rating;\r\n        } else {\r\n          throw new Error('Rating must be of type Rating');\r\n        }\r\n      },\r\n      {\r\n        isOptional: true,\r\n        defaultValue: {\r\n          xp: 0,\r\n          cr: 0,\r\n        },\r\n      },\r\n    ),\r\n    type: tryParser<ActorType>(\r\n      parser.parseType,\r\n      lines,\r\n      (value) => {\r\n        if (typeof value !== 'string') {\r\n          throw new Error(`Could not parse type: ${value}`);\r\n        }\r\n        return value;\r\n      },\r\n      {\r\n        isOptional: true,\r\n        defaultValue: '',\r\n      },\r\n    ),\r\n    alignment: tryParser<Alignment>(\r\n      parser.parseAlignment,\r\n      lines,\r\n      (alignment) => {\r\n        if (typeof alignment === 'string') {\r\n          return alignment;\r\n        }\r\n        throw new Error('Alignment must be string');\r\n      },\r\n      {\r\n        isOptional: true,\r\n        defaultValue: '',\r\n      },\r\n    ),\r\n    biography: tryParser<Biography>(\r\n      parser.parseBiography,\r\n      lines,\r\n      (biography) => {\r\n        if (typeof biography === 'string') {\r\n          return biography;\r\n        }\r\n        throw new Error('Biography must be string');\r\n      },\r\n      {\r\n        isOptional: true,\r\n        defaultValue: '',\r\n      },\r\n    ),\r\n    languages: tryParser<Languages>(\r\n      parser.parseLanguages,\r\n      lines,\r\n      (languages) => {\r\n        if (!Array.isArray(languages)) {\r\n          throw new Error(`Could not parse languages: ${languages}`);\r\n        }\r\n        return languages as Languages;\r\n      },\r\n      {\r\n        isOptional: true,\r\n        defaultValue: [],\r\n      },\r\n    ),\r\n    size: tryParser<Size>(\r\n      parser.parseSize,\r\n      lines,\r\n      (size) => {\r\n        if (typeof size !== 'string') {\r\n          throw new Error(`Could not parse size: ${size}`);\r\n        }\r\n        return size as Size;\r\n      },\r\n      {\r\n        isOptional: true,\r\n        defaultValue: 'Medium',\r\n      },\r\n    ),\r\n    health: tryParser(parser.parseHealth, lines, (health) => {\r\n      if (!(health as Health).value) {\r\n        throw new Error(`Could not parse health: ${health}`);\r\n      }\r\n      return health as Health;\r\n    }),\r\n    senses: tryParser(parser.parseSenses, lines, (senses) => {\r\n      if (!(senses as Senses).units) {\r\n        throw new Error(`Could not parse senses: ${senses}`);\r\n      }\r\n      return senses as Senses;\r\n    }),\r\n    armorClass: tryParser<ArmorClass>(parser.parseArmorClass, lines, (armorClass) => {\r\n      if (!(armorClass as ArmorClass).value) {\r\n        throw new Error(`Could not parse armor class: ${armorClass}`);\r\n      }\r\n      return armorClass as ArmorClass;\r\n    }),\r\n    damageImmunities: tryParser<DamageTypes>(parser.parseDamageImmunities, lines, damageTypeGuard, {\r\n      isOptional: true,\r\n      defaultValue: [],\r\n    }),\r\n    damageResistances: tryParser<DamageTypes>(parser.parseDamageResistances, lines, damageTypeGuard, {\r\n      isOptional: true,\r\n      defaultValue: [],\r\n    }),\r\n    conditionImmunities: tryParser<ConditionTypes>(\r\n      parser.parseConditionImmunities,\r\n      lines,\r\n      (conditionImmunities) => {\r\n        if (Array.isArray(conditionImmunities)) {\r\n          // Condition immunities are optional\r\n          return conditionImmunities as ConditionTypes;\r\n        }\r\n        throw new Error(`Could not parse condition immunities: ${conditionImmunities}`);\r\n      },\r\n      {\r\n        isOptional: true,\r\n        defaultValue: [],\r\n      },\r\n    ),\r\n    damageVulnerabilities: tryParser<DamageTypes>(parser.parseDamageVulnerabilities, lines, damageTypeGuard, {\r\n      isOptional: true,\r\n      defaultValue: [],\r\n    }),\r\n    abilities,\r\n    speed: tryParser<Speed>(parser.parseSpeed, lines, (speed) => {\r\n      if (typeof speed === 'number') {\r\n        return speed;\r\n      }\r\n      throw new Error('Speed must be number');\r\n    }),\r\n    skills: tryParser<Skill[]>(\r\n      parser.parseSkills,\r\n      lines,\r\n      (skills) => {\r\n        if (Array.isArray(skills)) {\r\n          return skills as Skill[];\r\n        }\r\n        throw new Error('Skills must be array');\r\n      },\r\n      {\r\n        isOptional: true,\r\n        defaultValue: [],\r\n      },\r\n    ),\r\n    items: tryParseItems(parser.parseItems, lines, abilities),\r\n    spells: tryParseSpells(parser.parseSpells, lines),\r\n    spellcasting: tryParseSpellcasting(parser.parseSpellcasting, lines),\r\n  };\r\n}\r\n\r\nexport type ParserOutput = ActorTypes;\r\nexport type ActorParser = (input: string[]) => ParserOutput;\r\n\r\nexport function tryActorParse(parsers: ImportActorParser[], lines: string[]): ImportActor {\r\n  const parserErrors = [];\r\n  for (const parser of parsers) {\r\n    try {\r\n      const result = trySingleActorParse(parser, lines);\r\n      return result;\r\n    } catch (error) {\r\n      parserErrors.push(error);\r\n    }\r\n  }\r\n  throw new Error(`Could not parse actor, errors: [${parserErrors.join(', ')}]`);\r\n}\r\n\r\nexport function tryParsers(parsers: ActorParser[], input: string[]): ParserOutput {\r\n  const parserErrors = [];\r\n  for (const parser of parsers) {\r\n    try {\r\n      const result = parser(input);\r\n      return result;\r\n    } catch (error) {\r\n      parserErrors.push(`Parser error for [${parser.name}] -> ${error}`);\r\n    }\r\n  }\r\n  throw new Error(`Could not parse element: ${JSON.stringify(parserErrors.join('\\n'), null, 2)}`);\r\n}\r\n\r\nexport function tryParser<T extends ActorTypes>(\r\n  parsers: ActorParser[],\r\n  lines: string[],\r\n  typeGuard: (result: unknown) => T,\r\n  optional?: { isOptional: true; defaultValue: T },\r\n): T {\r\n  const parserErrors = [];\r\n  for (const parser of parsers) {\r\n    try {\r\n      const result = parser(lines);\r\n      return typeGuard(result);\r\n    } catch (error) {\r\n      parserErrors.push(`Parser error for [${parser.name}] -> ${error}`);\r\n    }\r\n  }\r\n  if (optional && optional.isOptional) {\r\n    return optional.defaultValue;\r\n  } else {\r\n    throw new Error(`Could not parse element: ${JSON.stringify(parserErrors.join('\\n'), null, 2)}`);\r\n  }\r\n}\r\n\r\nexport function tryItemParsers(parsers: ItemParser[], input: string[], abilities: Abilities): ParserOutput {\r\n  const parserErrors = [];\r\n  for (const parser of parsers) {\r\n    try {\r\n      const result = parser(input, abilities);\r\n      return result;\r\n    } catch (error) {\r\n      parserErrors.push(error);\r\n    }\r\n  }\r\n  throw new Error(`Could not parse element: ${JSON.stringify(parserErrors.join('\\n'), null, 2)}`);\r\n}\r\n\r\nexport type ItemParser = (input: string[], abilities: Abilities) => ParserOutput;\r\nexport function tryParseItems(parsers: ItemParser[], lines: string[], abilities: Abilities): ImportItems {\r\n  const items = tryItemParsers(parsers, lines, abilities);\r\n  if (!Array.isArray(items)) {\r\n    throw new Error(`Could not parse items: ${items}`);\r\n  }\r\n  return items as ImportItems;\r\n}\r\n\r\nexport type SpellParser = (input: string[]) => ParserOutput;\r\nexport function tryParseSpells(parsers: SpellParser[], lines: string[]): ImportSpells {\r\n  const spells = tryParsers(parsers, lines);\r\n  if (!Array.isArray(spells)) {\r\n    throw new Error(`Could not parse spells: ${spells}`);\r\n  }\r\n  return spells as ImportSpells;\r\n}\r\n\r\nexport type SpellcastingParser = (input: string[]) => ParserOutput;\r\nexport function tryParseSpellcasting(parsers: SpellcastingParser[], lines: string[]): ImportSpellcasting {\r\n  const spellcasting = tryParsers(parsers, lines);\r\n  if (typeof spellcasting !== 'string') {\r\n    return '';\r\n  }\r\n  return spellcasting as ImportSpellcasting;\r\n}\r\n","import { ImportActor } from '../interfaces';\r\nimport { ACTOR_PARSERS } from './available';\r\n\r\nimport { tryActorParse } from './typeGuardParserRunners';\r\n\r\nexport function textToActor(input: string): ImportActor {\r\n  const lines = input.split('\\n');\r\n  return tryActorParse(ACTOR_PARSERS, lines);\r\n}\r\n","import { FifthItem } from '../../actor/templates/fifthedition';\r\nimport { CompendiumSpell, Packs, Pack } from './interfaces';\r\n\r\nlet dndPacks: null | Packs = null;\r\nlet otherPacks: null | Packs = null;\r\n\r\nconst getItemFromPackAsync = async (pack: Pack, itemName: string) => {\r\n  let result = null;\r\n  const lowerName = itemName.toLowerCase();\r\n  const item = pack.index.find((e) => lowerName === e?.name?.toLowerCase());\r\n\r\n  if (item) {\r\n    const itemDoc = await pack.getDocument(item._id);\r\n    result = itemDoc?.toObject();\r\n  }\r\n\r\n  return result;\r\n};\r\n\r\nexport const getItemImageFromPacksAsync = async (itemName: string, itemType: string): Promise<string | undefined> => {\r\n  const item = await getItemFromPacksAsync(itemName, itemType);\r\n  return (item as any)?.img;\r\n};\r\n\r\nexport const getItemFromPacksAsync = async (itemName: string, type: string): Promise<CompendiumSpell> => {\r\n  let result = null;\r\n\r\n  // Create pack arrays once to save time.\r\n  if (dndPacks == null && otherPacks == null) {\r\n    // Look through the non-default packs first, since those are more\r\n    // likely to contain customized versions of the dnd5e items.\r\n    dndPacks = [];\r\n    otherPacks = [];\r\n\r\n    for (const pack of (game as Game).packs) {\r\n      if ((pack.metadata as any).id.startsWith('dnd5e')) {\r\n        dndPacks.push(pack);\r\n      } else {\r\n        otherPacks.push(pack);\r\n      }\r\n    }\r\n  }\r\n\r\n  if (otherPacks != null) {\r\n    for (const pack of otherPacks) {\r\n      result = await getItemFromPackAsync(pack, itemName);\r\n\r\n      if (result && (!type || (result as any).type === type)) {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  if (result == null && dndPacks != null) {\r\n    for (const pack of dndPacks) {\r\n      result = await getItemFromPackAsync(pack, itemName);\r\n\r\n      if (result && (!type || (result as any).type === type)) {\r\n        break;\r\n      }\r\n    }\r\n  }\r\n\r\n  return result as FifthItem;\r\n};\r\n","import { ImportSpell } from '../actor/interfaces';\r\nimport { FifthItem } from '../actor/templates/fifthedition';\r\nimport { getItemFromPacksAsync, getItemImageFromPacksAsync } from './compendium/item';\r\nimport { ImportItem } from './interfaces';\r\n\r\nconst spellUsesToUses = (uses: ImportSpell['uses']): FifthItem['data']['uses'] => {\r\n  const { value, per } = uses;\r\n  const newUses = {\r\n    value,\r\n    max: value?.toString(),\r\n    per,\r\n  };\r\n  return newUses;\r\n};\r\n\r\nexport async function spellToFifth(passedSpell: ImportSpell): Promise<FifthItem | undefined> {\r\n  const spell = { ...passedSpell };\r\n  let item = await getItemFromPacksAsync(spell.name, 'spell');\r\n  if (!item) return;\r\n\r\n  let mode = undefined;\r\n  if (spell.uses.atWill) {\r\n    mode = 'innate';\r\n  }\r\n  item = {\r\n    ...item,\r\n    system: {\r\n      ...item.system,\r\n      preparation: {\r\n        ...item?.system?.preparation,\r\n        mode,\r\n      },\r\n      uses: spellUsesToUses(spell.uses),\r\n    },\r\n  };\r\n\r\n  const fifthItem = {\r\n    name: item.name,\r\n    type: item.type,\r\n    img: item.img,\r\n    data: {\r\n      ...item.system,\r\n    },\r\n  } as any;\r\n\r\n  return fifthItem;\r\n}\r\n\r\nexport async function itemToFifth(item: ImportItem): Promise<FifthItem> {\r\n  const img = await getItemImageFromPacksAsync(item.name, item.type);\r\n  const { name, save, uses, type, description, activation, damage, actionType, range, ability, attackBonus } = item;\r\n  const fifthUses = uses ? spellUsesToUses(uses) : undefined;\r\n\r\n  return {\r\n    name,\r\n    type,\r\n    img,\r\n    data: {\r\n      description: {\r\n        value: description,\r\n      },\r\n      activation,\r\n      damage,\r\n      actionType,\r\n      range,\r\n      ability,\r\n      save,\r\n      uses: fifthUses,\r\n      attackBonus: attackBonus?.toString(),\r\n    },\r\n  };\r\n}\r\n","import { textToActor } from './parsers';\r\nimport { actorToFifth, spellsToSpellSlots } from './convert';\r\nimport { UserData } from '../importForm';\r\nimport { FifthItem } from './templates/fifthedition';\r\nimport { itemToFifth, spellToFifth } from '../item/convert';\r\n\r\nasync function txtRoute(stringData: string) {\r\n  const actor = textToActor(stringData);\r\n  const { items } = actor;\r\n  const preparedItems = await Promise.all(\r\n    items.map((item) => {\r\n      return itemToFifth(item);\r\n    }),\r\n  );\r\n\r\n  let reducedSpells: Array<FifthItem> = [];\r\n  if (actor?.spells) {\r\n    const addedSpells: Array<FifthItem | undefined> = await Promise.all(\r\n      actor?.spells?.map((spell) => {\r\n        return spellToFifth(spell);\r\n      }),\r\n    );\r\n\r\n    reducedSpells = addedSpells.reduce((acc: FifthItem[], cur: FifthItem | undefined) => {\r\n      if (cur) {\r\n        acc.push(cur);\r\n      }\r\n      return acc;\r\n    }, []);\r\n\r\n    preparedItems.push(...reducedSpells);\r\n  }\r\n\r\n  const spellSlots = spellsToSpellSlots(actor.spells, reducedSpells);\r\n\r\n  const convertedActor = actorToFifth(actor);\r\n  convertedActor.spells = spellSlots;\r\n\r\n  // call spellSlots here\r\n  const foundryActor = await Actor.create({\r\n    name: actor.name,\r\n    type: 'npc',\r\n    data: convertedActor,\r\n  });\r\n\r\n  if (!foundryActor) return;\r\n\r\n  await Promise.all(\r\n    preparedItems.map(async (item: FifthItem) => {\r\n      const foundryItem = new Item(item);\r\n      await foundryActor.createEmbeddedDocuments('Item', [foundryItem.toObject()]);\r\n    }),\r\n  );\r\n}\r\n\r\nexport async function processActorInput({ jsonfile, clipboardInput }: UserData) {\r\n  if (clipboardInput) {\r\n    console.log(`Clipboard input: ${clipboardInput}`);\r\n    txtRoute(clipboardInput);\r\n    return;\r\n  }\r\n  const response = await fetch(jsonfile);\r\n  if (!response.ok) {\r\n    console.log(`Error reading ${jsonfile}`);\r\n    return;\r\n  }\r\n  const data = await response.text();\r\n  console.log(`Data: ${data}`);\r\n\r\n  const ext = jsonfile.split('.').pop();\r\n  switch (ext) {\r\n    default:\r\n      console.log(`Unknown file type ${ext}`);\r\n  }\r\n}\r\n","// type guard game\r\nexport const isGame = (game: unknown): game is Game => {\r\n  return game !== {} && game !== null && game !== undefined;\r\n};\r\n","import { isGame } from '../guards/game';\r\n\r\nexport const supportsJournalPages = () => {\r\n  if (isGame(game)) {\r\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n    const release = (game as any).release;\r\n    return release.generation >= 10;\r\n  }\r\n  return false;\r\n};\r\n","import { FoundryApi } from '.';\r\nimport { TextBlock } from '../parsers';\r\n\r\nexport interface JournalOptions {\r\n  folder?: string;\r\n}\r\n\r\nexport async function buildTextBlock(input: TextBlock, api: FoundryApi, opts: JournalOptions): Promise<void> {\r\n  await api.foundryJournalEntry.create({\r\n    name: input?.name ?? 'Unknown Name',\r\n    content: input.content,\r\n    folder: opts?.folder,\r\n    sort: input.sortValue,\r\n  });\r\n}\r\n","import { cleanName } from '../../formatters';\r\nimport { Config } from '../../settings';\r\nimport { FoundryApi } from '../builder';\r\n\r\nexport interface Note {\r\n  value: string;\r\n  tag: string;\r\n}\r\n\r\nexport interface JournalNode {\r\n  value: string;\r\n  tag: string;\r\n  notes: Array<Note>;\r\n  children: Array<JournalNode>;\r\n  sortValue?: number;\r\n}\r\n\r\nexport function getRootName(jsonfile: string) {\r\n  // get file name from full path\r\n  const fileName = jsonfile.split('/').pop() || jsonfile;\r\n  // remove extension\r\n  const name = fileName.split('.').shift() || fileName;\r\n  // convert _ to space\r\n  const rootName = name.replace(/_/g, ' ');\r\n  // Capitalize first letter\r\n  return rootName.charAt(0).toUpperCase() + rootName.slice(1);\r\n}\r\n\r\nexport const formatList = (note: string) => {\r\n  let prepend = '';\r\n  if (note.includes('1. ') && note.includes('2. ')) {\r\n    const splitNote = note.split(/[0-9]+\\./);\r\n    if (note[0] !== '1') {\r\n      prepend = splitNote[0];\r\n      splitNote.shift();\r\n    }\r\n    let asList = splitNote.map((listItem: string) => {\r\n      return `<li>${listItem.replace('\\n', '').trim()}</li>`;\r\n    });\r\n    asList = asList.filter((item) => item !== '<li></li>');\r\n    return `${prepend}<ol>${asList.join('')}</ol>`;\r\n  }\r\n  return `${note}`;\r\n};\r\n\r\nexport function normalizeHeaders(note: Note) {\r\n  if (note.tag.includes('h')) {\r\n    if (Number(note.tag.replace('h', '')) > 10) {\r\n      note.tag = 'p';\r\n    }\r\n  }\r\n  const tag = note.tag.includes('h') ? 'h2' : note.tag;\r\n  return `<${tag}>${note.value}</${tag}>`;\r\n}\r\n\r\nconst noteMaps = (note: string) => {\r\n  return formatList(note);\r\n};\r\n\r\nexport const mergeParagraphs = (noteList: Note[], current: Note): Note[] => {\r\n  if (current.tag !== 'p') {\r\n    noteList.push(current);\r\n    return noteList;\r\n  }\r\n  if (noteList.length === 0) {\r\n    noteList.push(current);\r\n    return noteList;\r\n  }\r\n\r\n  if (noteList[noteList.length - 1].tag === 'p') {\r\n    noteList[noteList.length - 1].value += `\\n${current.value}`;\r\n  } else {\r\n    noteList.push(current);\r\n  }\r\n  return noteList;\r\n};\r\n\r\nconst collission_tracker: Record<string, number> = {};\r\nexport interface CreateFolderParams {\r\n  node: JournalNode;\r\n  rootFolder: StoredDocument<Folder>;\r\n  currentFolder?: StoredDocument<Folder>;\r\n  currentDepth: number;\r\n  settings: Config;\r\n}\r\n\r\nexport async function createFoldersRecursive(\r\n  { node, rootFolder, currentFolder, currentDepth = 1, settings }: CreateFolderParams,\r\n  api: FoundryApi,\r\n): Promise<void> {\r\n  const { foundryFolder, foundryJournalEntry } = api;\r\n  let folder: StoredDocument<Folder> = currentFolder ?? rootFolder;\r\n  // if node.value in collission_tracker, then we have a collision\r\n  collission_tracker[node.value] = collission_tracker[node.value] ?? 0;\r\n  collission_tracker[node.value]++;\r\n  const name = `${node.value}`;\r\n\r\n  if (node.children.length > 0 && currentDepth < settings.folderDepth) {\r\n    const current_id = currentFolder?.data?._id ?? rootFolder.data._id;\r\n    folder =\r\n      (await foundryFolder.create({\r\n        name: cleanName(name),\r\n        type: 'JournalEntry',\r\n        parent: current_id,\r\n        sorting: 'm',\r\n      })) ?? rootFolder;\r\n    currentDepth++;\r\n  }\r\n  const notes = node.notes.reverse();\r\n  const reduced = notes.reduce(mergeParagraphs, []);\r\n  const values = reduced.map(normalizeHeaders);\r\n  const finalNotes = values.map(noteMaps).reverse();\r\n  let htmlNote = finalNotes.reduce((note: string, htmlNote: string) => {\r\n    return `${htmlNote}${note}`;\r\n  }, ``);\r\n  htmlNote = `<div>${htmlNote}</div>`;\r\n  await foundryJournalEntry.create({\r\n    name: `${cleanName(name)}`,\r\n    content: htmlNote,\r\n    collectionName: node.value,\r\n    folder: folder?.data?._id,\r\n    sort: node.sortValue ?? 0,\r\n  });\r\n\r\n  function getSortValue(title: string) {\r\n    // if first two characters are a number, extract the number\r\n    const firstTwo = title.substring(0, 2);\r\n    if (firstTwo.match(/^\\d+$/)) {\r\n      return parseInt(firstTwo, 10);\r\n    }\r\n    // if the first character is a number, extract the number\r\n    const first = title.substring(0, 1);\r\n    if (first.match(/^\\d+$/)) {\r\n      return parseInt(first, 10);\r\n    }\r\n    // otherwise, return the ascii value of the first characters\r\n    return first.charCodeAt(0);\r\n  }\r\n\r\n  if (node.children) {\r\n    const children = node.children.map((child) => {\r\n      return { ...child, sortValue: getSortValue(child.value) };\r\n    });\r\n    for (const child of children) {\r\n      await createFoldersRecursive({ node: child, rootFolder, currentFolder: folder, currentDepth, settings }, api);\r\n    }\r\n  }\r\n}\r\n\r\nexport async function journalFromJson(name: string, data: JournalNode[]) {\r\n  const folder = await Folder.create({\r\n    name: cleanName(name),\r\n    type: 'JournalEntry',\r\n    sorting: 'm',\r\n  });\r\n  if (!folder) {\r\n    console.log(`Error creating folder ${name}`);\r\n    return;\r\n  } else {\r\n    const settings = Config._load();\r\n    console.log(`Building journals with a depth of ${settings.folderDepth}`);\r\n    data.forEach(async (section: JournalNode) => {\r\n      await createFoldersRecursive(\r\n        { node: section, rootFolder: folder, currentDepth: 1, settings },\r\n        {\r\n          foundryFolder: Folder,\r\n          foundryJournalEntry: JournalEntry,\r\n        },\r\n      );\r\n    });\r\n    console.log(`Finished generating ${name} Journals...`);\r\n  }\r\n}\r\n","import { formatList } from './pdfJson';\r\n\r\nexport interface TextBlock {\r\n  name: string;\r\n  content: string;\r\n  sortValue?: number;\r\n}\r\n\r\nfunction newLineToHTML(content: string): string {\r\n  return content.replace(/\\n/g, '<br>');\r\n}\r\n\r\nfunction symbolToList(content: string, symbol: string): string {\r\n  let lines = content.split('\\n');\r\n  let firstBulletLine = -1;\r\n  let lastBulletLine = -1;\r\n  lines = lines.map((line, index) => {\r\n    if (line.includes(symbol) && firstBulletLine === -1) {\r\n      firstBulletLine = index;\r\n    }\r\n    if (line.includes(symbol)) {\r\n      lastBulletLine = index;\r\n      line = line.replace(symbol, '');\r\n      return `<li>${line}</li>`;\r\n    } else {\r\n      return line;\r\n    }\r\n  });\r\n  if (firstBulletLine !== -1 && lastBulletLine !== -1) {\r\n    lines[firstBulletLine] = `<ul>${lines[firstBulletLine]}`;\r\n    lines[lastBulletLine] = `${lines[lastBulletLine]}</ul>`;\r\n    const beforeList = lines.slice(0, firstBulletLine).join('\\n');\r\n    const list = lines.slice(firstBulletLine, lastBulletLine + 1).join('');\r\n    const afterList = lines.slice(lastBulletLine + 1).join('\\n');\r\n    return `${beforeList}\\n${list}\\n${afterList}`;\r\n  }\r\n  return content;\r\n}\r\n\r\nfunction bulletToList(content: string): string {\r\n  return symbolToList(content, '•');\r\n}\r\n\r\nfunction dashToList(content: string): string {\r\n  return symbolToList(content, '-');\r\n}\r\n\r\nfunction allCapWordsToBold(content: string): string {\r\n  return content.replace(/\\b[A-Z]{2,}\\b/g, (match) => `<b>${match}</b>`);\r\n}\r\n\r\nexport function startsWithName(line: string) {\r\n  const re = /\\b[A-Z]{1}[a-z]{1,}\\b\\./g;\r\n  const matches = line.match(re);\r\n  if (matches === null) {\r\n    return false;\r\n  }\r\n  const start = line.split('.')[0];\r\n  if (start.split(' ').length > 3) {\r\n    return false;\r\n  }\r\n  return true;\r\n}\r\n\r\nfunction namesToBold(content: string): string {\r\n  let split = content.split('\\n');\r\n  split = split.filter((line) => line !== '');\r\n  split = split.map((line) => {\r\n    if (startsWithName(line)) {\r\n      const name = line.split('.')[0];\r\n      const bold = `<b>${name}</b>`;\r\n      line = line.replace(name, bold);\r\n    }\r\n    return line;\r\n  });\r\n  return split.join('\\n');\r\n}\r\n\r\nexport function formatContent(content: string): string {\r\n  const formatters = [formatList, allCapWordsToBold, namesToBold, bulletToList, dashToList, newLineToHTML];\r\n  return formatters.reduce((acc, current) => {\r\n    acc = current(acc);\r\n    return acc;\r\n  }, content);\r\n}\r\n\r\nexport function parseTextBlock(input: string): TextBlock {\r\n  const name = input.split('\\n')[0];\r\n  const content = input.split('\\n').slice(1).join('\\n');\r\n  return { name, content: formatContent(content) };\r\n}\r\n","import { TextBlock } from '.';\r\nimport { formatContent } from './textBlock';\r\n\r\nexport interface MultipleTextBlocks {\r\n  entries: TextBlock[];\r\n}\r\n\r\ninterface Page {\r\n  title: { show: true };\r\n  name: string;\r\n  type: 'text';\r\n  text: {\r\n    content: string;\r\n    format: any; // Replace 'any' with the appropriate type for format\r\n  };\r\n}\r\n\r\nexport function isTitle(line: string) {\r\n  const shortEnough = line.split(' ').length < 7;\r\n  const endsWithColon = line.endsWith(':');\r\n  // first character and last character are parens\r\n  const hasParens = line.trim().startsWith('(') && line.trim().endsWith(')');\r\n  return (\r\n    shortEnough &&\r\n    !line.includes('•') &&\r\n    line.length > 0 &&\r\n    !endsWithColon &&\r\n    !hasParens &&\r\n    !line.endsWith(',') &&\r\n    !line.startsWith('-') &&\r\n    !line.endsWith('-') &&\r\n    !line.startsWith('–') &&\r\n    !line.endsWith('–')\r\n  );\r\n}\r\n\r\nexport const parseMultipleTextBlocks = (input: string): MultipleTextBlocks => {\r\n  const lines = input.split('\\n');\r\n  let entries: TextBlock[] = [];\r\n  lines.forEach((line) => {\r\n    if (isTitle(line)) {\r\n      const name = line.trim();\r\n      entries.push({ name, content: '' });\r\n    } else {\r\n      if (entries[entries.length - 1] === undefined) {\r\n        const name = line.trim();\r\n        entries.push({ name, content: '' });\r\n      }\r\n      entries[entries.length - 1].content += `\\n${line}`;\r\n    }\r\n  });\r\n  entries = entries.filter(({ name, content }) => name !== '' && content !== '');\r\n  let index = 0;\r\n  return {\r\n    entries: entries.map((entry) => {\r\n      return {\r\n        name: entry.name,\r\n        content: formatContent(entry.content),\r\n        sortValue: index++,\r\n      };\r\n    }),\r\n  };\r\n};\r\n\r\nexport const parseMultipleTextPages = (input: string) => {\r\n  const lines = input.split('\\n');\r\n  let entries: TextBlock[] = [];\r\n  lines.forEach((line) => {\r\n    if (isTitle(line)) {\r\n      const name = line.trim();\r\n      entries.push({ name, content: '' });\r\n    } else {\r\n      if (entries[entries.length - 1] === undefined) {\r\n        const name = line.trim();\r\n        entries.push({ name, content: '' });\r\n      }\r\n      entries[entries.length - 1].content += `\\n${line}`;\r\n    }\r\n  });\r\n  entries = entries.filter(({ name, content }) => name !== '' && content !== '');\r\n  let index = 0;\r\n  return {\r\n    pages: entries.map((entry) => {\r\n      return {\r\n        title: { show: true },\r\n        name: entry.name,\r\n        type: 'text',\r\n        text: {\r\n          content: formatContent(entry.content),\r\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n          format: (CONST as unknown as any).JOURNAL_ENTRY_PAGE_FORMATS.HTML,\r\n        },\r\n        sortValue: index++,\r\n      };\r\n    }),\r\n  };\r\n};\r\n\r\ninterface CONSTANTS {\r\n  JOURNAL_ENTRY_PAGE_FORMATS: {\r\n    HTML: 'html';\r\n  };\r\n}\r\n\r\nexport const parseHTMLIntoMultiplePages = (input: string, constants: CONSTANTS = CONST as unknown as CONSTANTS) => {\r\n  const sections = input.split(/(?=<h1>)/);\r\n\r\n  const pages = sections.map((section) => {\r\n    const h1Regex = /<h1>(.*?)<\\/h1>/g;\r\n\r\n    const title = h1Regex.exec(section)?.[1] ?? 'Parsed Page';\r\n    const content = section.replace(h1Regex, '').trim();\r\n\r\n    if (title && content) {\r\n      return {\r\n        title: { show: true },\r\n        name: title,\r\n        type: 'text',\r\n        text: {\r\n          content,\r\n          format: constants.JOURNAL_ENTRY_PAGE_FORMATS.HTML,\r\n        },\r\n      };\r\n    }\r\n    return undefined;\r\n  });\r\n\r\n  const filteredPages = pages.filter((page) => page !== undefined) as Page[];\r\n\r\n  return { pages: filteredPages };\r\n};\r\n","import { supportsJournalPages } from '../../game';\r\nimport { UserData } from '../../importForm';\r\nimport { buildTextBlock } from '../builder/textBlock';\r\nimport { getRootName, journalFromJson, JournalNode, parseTextBlock } from '../parsers';\r\nimport {\r\n  parseMultipleTextBlocks,\r\n  parseMultipleTextPages,\r\n  parseHTMLIntoMultiplePages,\r\n} from '../parsers/multipleTextBlocks';\r\n\r\nfunction isHTML(str: string) {\r\n  const a = document.createElement('div');\r\n  a.innerHTML = str;\r\n\r\n  for (let c = a.childNodes, i = c.length; i--; ) {\r\n    if (c[i].nodeType == 1) return true;\r\n  }\r\n\r\n  return false;\r\n}\r\n\r\nasync function multipleRoutePages(input: string): Promise<void> {\r\n  const data = isHTML(input) ? parseHTMLIntoMultiplePages(input) : parseMultipleTextPages(input);\r\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\r\n  (JournalEntry as unknown as any).implementation.create({\r\n    pages: data.pages,\r\n    name: 'Parsed Journal Entries',\r\n  });\r\n}\r\n\r\nasync function multipleRoute(input: string): Promise<void> {\r\n  const folder = await Folder.create({\r\n    name: 'Parsed Journal Entries',\r\n    type: 'JournalEntry',\r\n    sorting: 'm',\r\n  });\r\n  const blocks = parseMultipleTextBlocks(input);\r\n  await Promise.all(\r\n    blocks.entries.map(async (block) => {\r\n      return await buildTextBlock(\r\n        block,\r\n        {\r\n          foundryFolder: Folder,\r\n          foundryJournalEntry: JournalEntry,\r\n        },\r\n        { folder: folder?.data?._id },\r\n      );\r\n    }),\r\n  );\r\n}\r\n\r\nexport async function processInputJSON({ jsonfile, clipboardInput, buildMultiple }: UserData) {\r\n  if (clipboardInput) {\r\n    if (buildMultiple) {\r\n      if (supportsJournalPages()) {\r\n        return await multipleRoutePages(clipboardInput);\r\n      } else {\r\n        // TODO: remove this once we have deprecated v9 support\r\n        return await multipleRoute(clipboardInput);\r\n      }\r\n    }\r\n    const input = parseTextBlock(clipboardInput);\r\n    await buildTextBlock(\r\n      input,\r\n      {\r\n        foundryFolder: Folder,\r\n        foundryJournalEntry: JournalEntry,\r\n      },\r\n      {},\r\n    );\r\n    return;\r\n  }\r\n  const response = await fetch(jsonfile);\r\n  if (!response.ok) {\r\n    console.log(`Error reading ${jsonfile}`);\r\n    return;\r\n  }\r\n  const data = await response.text();\r\n  const json = JSON.parse(data) as JournalNode[];\r\n  const name = getRootName(jsonfile);\r\n  journalFromJson(name, json);\r\n}\r\n","import { Config, registerSettings } from './settings';\r\nimport { preloadTemplates } from './preloadTemplates';\r\nimport { processTableJSON } from './table/process';\r\nimport { renderSidebarButtons } from './renderSidebarButtons';\r\nimport CONSTANTS from './constants';\r\nimport { processItemInput } from './item/handleInput';\r\nimport { processActorInput } from './actor/handleInput';\r\nimport { processInputJSON } from './journal/routes';\r\n\r\n// Hook for each specific directory tab render event\r\nHooks.on('renderJournalDirectory', (app: any, html: JQuery) => {\r\n  if (!(game as Game)?.user?.isGM) return;\r\n  const config = Config._load();\r\n  if (config.journalImporter) {\r\n    renderSidebarButtons(app, 'journal', processInputJSON);\r\n  }\r\n});\r\n\r\nHooks.on('renderRollTableDirectory', (app: any, html: JQuery) => {\r\n  if (!(game as Game)?.user?.isGM) return;\r\n  const config = Config._load();\r\n  if (config.tableImporter) {\r\n    renderSidebarButtons(app, 'tables', processTableJSON);\r\n  }\r\n});\r\n\r\nHooks.on('renderActorDirectory', (app: any, html: JQuery) => {\r\n  if (!(game as Game)?.user?.isGM) return;\r\n  const config = Config._load();\r\n  if (config.actorImporter) {\r\n    renderSidebarButtons(app, 'actors', processActorInput);\r\n  }\r\n});\r\n\r\nHooks.on('renderItemDirectory', (app: any, html: JQuery) => {\r\n  if (!(game as Game)?.user?.isGM) return;\r\n  const config = Config._load();\r\n  if (config.itemImporter) {\r\n    renderSidebarButtons(app, 'items', processItemInput);\r\n  }\r\n});\r\n\r\n// Initialize module\r\nHooks.once('init', async () => {\r\n  console.log(`${CONSTANTS.module.name} | Initializing ${CONSTANTS.module.title}`);\r\n  // Assign custom classes and constants here\r\n\r\n  // Register custom module settings\r\n  registerSettings();\r\n\r\n  // Preload Handlebars templates\r\n  await preloadTemplates();\r\n\r\n  // Register custom sheets (if any)\r\n});\r\n\r\n// When ready\r\nHooks.once('ready', async () => {\r\n  // Do anything once the module is ready\r\n});\r\n"],"names":["cleanName","txtRoute","ImportJournalForm","ImportTableForm","ImportActorForm","ImportItemForm"],"mappings":"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"}